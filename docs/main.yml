openapi: 3.0.0
info:
  title: API External
  version: 1.0.0
  description: Endpoints de los servicios.
servers:
- url: https://dev-profiles-agregaapi.transfer.com
tags:
- name: devices / catalogos
  description: Catálogos de dispositivos
- name: devices / terminales
  description: Terminales de dispositivos
- name: devices / transacciones
  description: Transacciones de dispositivos
x-tagGroups:
- name: Devices
  tags:
  - devices / catalogos
  - devices / terminales
  - devices / transacciones
  - devices / transacciones / backoffice
  - devices / transacciones / advisor
  - devices / transacciones / report
paths:
  /api/catalog/terminalModels:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / catalogos
      summary: Obtener modelos de terminal por catálogo
      description: 'Obtiene la lista de modelos de terminal agrupados por tipo de
        dispositivo.

        '
      operationId: getTerminalModelsCatalog
      security:
      - Authorization: []
      responses:
        '200':
          description: Respuesta exitosa con los modelos de terminal.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: max
                        models:
                          type: array
                          items:
                            type: object
                            properties:
                              name:
                                type: string
                                example: A920
              examples:
                example-1:
                  value:
                    message: success
                    response:
                    - name: max
                      models:
                      - name: A920
                      - name: PXA35
                    - name: pocket
                      models:
                      - name: D180
                      - name: MP63
        '401':
          description: No autorizado. Se requiere autenticación inherente.
  /api/terminal/:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Crear terminal
      description: Crea una nueva terminal (requiere token Backoffice).
      operationId: createTerminal
      security:
      - BackofficeAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - name
              - serialNumber
              - warehouseManager
              - systemChargeResponsible
              - arrivalTrackingGuide
              - parcelDistributor
              - arrivalDate
              properties:
                name:
                  type: string
                  description: Nombre de la terminal.
                  example: Ingenico Desk5000
                serialNumber:
                  type: string
                  description: Número de serie único de la terminal.
                  example: 0821407462
                warehouseManager:
                  type: string
                  description: Responsable de almacén.
                  example: Juan Pérez
                systemChargeResponsible:
                  type: string
                  description: Responsable de carga del sistema.
                  example: María López
                arrivalTrackingGuide:
                  type: string
                  description: Guía de rastreo de llegada.
                  example: ESTAFETA-123456789
                parcelDistributor:
                  type: string
                  description: Paquetería.
                  example: Estafeta
                arrivalDate:
                  type: string
                  format: date-time
                  description: Fecha de arribo.
                  example: '2025-08-20T15:30:00Z'
                chipSerialNumber:
                  type: string
                  description: (Opcional) Número de serie del chip 1.
                  example: '8934076501234567890'
                chipTwoSerialNumber:
                  type: string
                  description: (Opcional) Número de serie del chip 2.
                  example: '8934076500987654321'
                imeiTerminal:
                  type: string
                  description: (Opcional) IMEI principal de la terminal.
                  example: '353490123456789'
                imeiTwoTerminal:
                  type: string
                  description: (Opcional) Segundo IMEI de la terminal.
                  example: '353490987654321'
            example:
              name: Ingenico Desk5000
              serialNumber: 0821407462
              warehouseManager: Juan Pérez
              systemChargeResponsible: María López
              arrivalTrackingGuide: ESTAFETA-123456789
              parcelDistributor: Estafeta
              arrivalDate: '2025-08-20T15:30:00Z'
              chipSerialNumber: '8934076501234567890'
              imeiTerminal: '353490123456789'
      responses:
        '200':
          description: Terminal creada exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  created:
                    type: boolean
                    example: true
                  terminal:
                    type: object
                    description: Registro creado en base de datos. Se listan los campos
                      conocidos; el objeto puede incluir propiedades adicionales del
                      modelo.
                    additionalProperties: true
                    properties:
                      _id:
                        type: string
                        description: ID de la terminal (ObjectId).
                        example: 66d0f0c2f2a4b3f5c1a2b3c4
                      name:
                        type: string
                      serialNumber:
                        type: string
                      warehouseManager:
                        type: string
                      systemChargeResponsible:
                        type: string
                      arrivalTrackingGuide:
                        type: string
                      parcelDistributor:
                        type: string
                      arrivalDate:
                        type: string
                        format: date-time
                      chipSerialNumber:
                        type: string
                      chipTwoSerialNumber:
                        type: string
                      imeiTerminal:
                        type: string
                      imeiTwoTerminal:
                        type: string
                      active:
                        type: boolean
                        description: Indicador de actividad del registro.
                      id:
                        type: string
                        description: ID virtual (si el esquema lo expone).
              example:
                message: success
                created: true
                terminal:
                  _id: 66d0f0c2f2a4b3f5c1a2b3c4
                  name: Ingenico Desk5000
                  serialNumber: 0821407462
                  warehouseManager: Juan Pérez
                  systemChargeResponsible: María López
                  arrivalTrackingGuide: ESTAFETA-123456789
                  parcelDistributor: Estafeta
                  arrivalDate: '2025-08-20T15:30:00.000Z'
                  chipSerialNumber: '8934076501234567890'
                  imeiTerminal: '353490123456789'
                  active: true
                  id: TER-00001234
        '400':
          description: Error de validación de datos.
          content:
            application/json:
              schema:
                oneOf:
                - type: object
                  properties:
                    error:
                      type: object
                      properties:
                        message:
                          type: string
                          example: 'ValidationError: ''arrivalDate'' is required'
                - type: object
                  properties:
                    code:
                      type: string
                      example: INVALID_OBJECT_ID
                    error:
                      type: object
                      properties:
                        message:
                          type: string
                          example: ID inválido proporcionado
              examples:
                invalidPayload:
                  value:
                    error:
                      message: 'ValidationError: ''arrivalDate'' is required'
                invalidObjectId:
                  value:
                    code: INVALID_OBJECT_ID
                    error:
                      message: ID inválido proporcionado
        '401':
          description: Token expirado o no autorizado.
          content:
            application/json:
              schema:
                oneOf:
                - type: object
                  properties:
                    error:
                      type: object
                      properties:
                        name:
                          type: string
                          example: TokenExpiredError
                        message:
                          type: string
                          example: jwt expired
                - type: object
                  properties:
                    code:
                      type: string
                      example: ACCESS_TOKEN_EXPIRED
                    error:
                      type: object
                      properties:
                        name:
                          type: string
                          example: TokenExpiredError
              examples:
                tokenExpired:
                  value:
                    code: ACCESS_TOKEN_EXPIRED
                    error:
                      name: TokenExpiredError
                      message: jwt expired
        '409':
          description: Conflicto — número de serie duplicado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    oneOf:
                    - type: object
                      properties:
                        name:
                          type: string
                          example: El numero de serie ya está ocupado 66d0f0c2f2a4b3f5c1a2b3c4
                        statusCode:
                          type: number
                          example: 409
              example:
                error:
                  name: El numero de serie ya está ocupado 66d0f0c2f2a4b3f5c1a2b3c4
                  statusCode: 409
        '500':
          description: Error interno o de base de datos / errores propagados de servicios
            externos (Axios).
          content:
            application/json:
              schema:
                oneOf:
                - type: object
                  properties:
                    error:
                      type: object
                      properties:
                        message:
                          type: string
                          example: Error en la base de datos
                        code:
                          type: number
                          example: 11000
                - type: object
                  properties:
                    statusCode:
                      type: number
                      example: 500
                    error:
                      type: object
                      properties:
                        message:
                          type: string
                          example: 'Error axios: 500 ...'
              examples:
                mongoError:
                  value:
                    error:
                      message: Error en la base de datos
                      code: 11000
                axiosPassthrough:
                  value:
                    statusCode: 500
                    error:
                      message: Upstream service failed
  /api/terminal/tpvLogin:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Login de terminal TPV
      description: 'Autentica una terminal usando serialNumber y apiKey.

        Valida que la terminal esté activa (active=true) y no pendiente (pending=false).

        '
      operationId: tpvLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - serialNumber
              - apiKey
              properties:
                serialNumber:
                  type: string
                  description: Número de serie de la terminal.
                  example: 0821407462
                apiKey:
                  type: string
                  description: API Key asignada a la terminal.
                  example: b50f9c1a-4e5d-4f5a-8d92-9b4b2e6b3f7c
            example:
              serialNumber: 0821407462
              apiKey: b50f9c1a-4e5d-4f5a-8d92-9b4b2e6b3f7c
      responses:
        '200':
          description: Resultado de la autenticación.
          content:
            application/json:
              schema:
                oneOf:
                - type: object
                  description: API key inválida.
                  properties:
                    message:
                      type: string
                      example: success
                    result:
                      type: boolean
                      example: false
                  required:
                  - message
                  - result
                - type: object
                  description: Autenticación exitosa.
                  properties:
                    message:
                      type: string
                      example: success
                    result:
                      type: boolean
                      example: true
                    commerce:
                      type: string
                      description: ID del comercio asignado.
                      example: 64f9c1a4e5d4f5a8d929b4b2
                    branchId:
                      type: string
                      description: ID de la sucursal asignada.
                      example: 64f9c1a4e5d4f5a8d929b4b3
                    internalCommerceId:
                      type: string
                      example: COM-00123
                    terminalId:
                      type: string
                      example: TER-00004567
                    operativeMode:
                      type: string
                      example: ONLINE
                  required:
                  - message
                  - result
              examples:
                invalidApiKey:
                  value:
                    message: success
                    result: false
                validApiKey:
                  value:
                    message: success
                    result: true
                    commerce: 64f9c1a4e5d4f5a8d929b4b2
                    branchId: 64f9c1a4e5d4f5a8d929b4b3
                    internalCommerceId: COM-00123
                    terminalId: TER-00004567
                    operativeMode: ONLINE
        '400':
          description: Error de validación del body (serialNumber/apiKey vacíos o
            inválidos).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 'ValidationError: ''serialNumber'' is required'
              example:
                error:
                  message: 'ValidationError: ''serialNumber'' is required'
        '404':
          description: No se encontró la terminal con el número de serie proporcionado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Terminal no encontrada
                      statusCode:
                        type: integer
                        example: 404
              example:
                error:
                  name: Terminal no encontrada
                  statusCode: 404
        '500':
          description: Error interno o de base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Error en la base de datos
                      code:
                        type: integer
                        example: 11000
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/terminal:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Buscar terminales
      description: 'Obtiene una lista de terminales según el filtro seleccionado.

        Puedes filtrar por `warehouse` o `commerce`.

        '
      operationId: buscarTerminales
      security:
      - Authorization: []
      parameters:
      - name: filter
        in: query
        description: Filtro de búsqueda (`warehouse` o `commerce`).
        required: false
        schema:
          type: string
          enum:
          - warehouse
          - commerce
      responses:
        '200':
          description: Respuesta exitosa con la lista de terminales.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      count:
                        type: integer
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          perPage:
                            type: integer
                          totalPages:
                            type: integer
                      terminals:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                            model:
                              type: string
                            serialNumber:
                              type: string
                            warehouseManager:
                              type: string
                            systemChargeResponsible:
                              type: string
                            arrivalTrackingGuide:
                              type: string
                            parcelDistributor:
                              type: string
                            arrivalDate:
                              type: string
                              format: date-time
                            chipSerialNumber:
                              type: string
                            chipTwoSerialNumber:
                              type: string
                            imeiTerminal:
                              type: string
                            imeiTwoTerminal:
                              type: string
                            location:
                              type: string
                            status:
                              type: string
                            pending:
                              type: boolean
                            active:
                              type: boolean
                            createdAt:
                              type: string
                              format: date-time
                            updatedAt:
                              type: string
                              format: date-time
                            id:
                              type: integer
                            ID_Terminal:
                              type: string
                            otpGeneratedBy:
                              type: string
                            branchId:
                              type: string
                            commerce:
                              type: string
                            franchise:
                              type: string
                            internalCommerceId:
                              type: integer
                            otpCode:
                              type: string
                            otpExpiresAt:
                              type: string
                              format: date-time
                            otpStatus:
                              type: string
                            apiKey:
                              type: string
                            commerceName:
                              type: string
              example:
                message: success
                response:
                  count: 7
                  pagination:
                    page: 1
                    perPage: 10
                    totalPages: 1
                  terminals:
                  - _id: b1224731-644d-4533-a280-32ace66a5785
                    name: pocket
                    model: max
                    serialNumber: '123'
                    warehouseManager: test
                    systemChargeResponsible: test
                    arrivalTrackingGuide: dhl
                    parcelDistributor: dhl
                    arrivalDate: '2025-07-17T05:00:00.000Z'
                    chipSerialNumber: test
                    chipTwoSerialNumber: test
                    imeiTerminal: prueb
                    imeiTwoTerminal: testp
                    location: commerce
                    status: COMPLETED
                    pending: false
                    active: true
                    createdAt: '2025-07-17T20:10:08.025Z'
                    updatedAt: '2025-07-17T20:10:08.025Z'
                    id: 502
                    ID_Terminal: TERM56455
                    otpGeneratedBy: ''
                    branchId: 'testff                              '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: dd7666e4-287b-45b8-8f89-7bb59422b867
                    internalCommerceId: 544
                    otpCode: mhyd
                    otpExpiresAt: '2025-08-22T07:25:21.325Z'
                    otpStatus: ggg
                    apiKey: ggg
                    commerceName: Elotes Dan
                  - _id: e29c22d9-e4f5-4a87-a2fc-81313721aaf3
                    name: Miss Lisa Emard
                    model: cinis
                    serialNumber: tantillus
                    warehouseManager: vilicus
                    systemChargeResponsible: attero
                    arrivalTrackingGuide: adsuesco
                    parcelDistributor: voluptatem
                    arrivalDate: '2025-05-22T02:14:02.621Z'
                    chipSerialNumber: verus
                    chipTwoSerialNumber: depulso
                    imeiTerminal: averto
                    imeiTwoTerminal: provident
                    location: commerce
                    status: REFUNDED
                    pending: true
                    active: true
                    createdAt: '2025-05-22T06:12:23.236Z'
                    updatedAt: '2025-05-22T00:46:26.856Z'
                    id: 990
                    ID_Terminal: TERM7731
                    otpGeneratedBy: ''
                    branchId: 'denuncio                            '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: 'aliqua                              '
                    internalCommerceId: 478
                    otpCode: iste
                    otpExpiresAt: '2025-05-22T02:59:19.831Z'
                    otpStatus: abduco
                    apiKey: quam
                    commerceName: Elotes Dan
                  - _id: 02661572-7c95-4e39-8d4b-0fb78f2dff55
                    name: pocket
                    model: tantillus
                    serialNumber: '123'
                    warehouseManager: amor
                    systemChargeResponsible: voco
                    arrivalTrackingGuide: vestrum
                    parcelDistributor: denego
                    arrivalDate: '2025-05-22T01:33:44.163Z'
                    chipSerialNumber: solus
                    chipTwoSerialNumber: pel
                    imeiTerminal: ater
                    imeiTwoTerminal: tenax
                    location: commerce
                    status: PENDING
                    pending: false
                    active: true
                    createdAt: '2025-05-22T04:26:09.466Z'
                    updatedAt: '2025-07-18T19:00:29.884Z'
                    id: 874
                    ID_Terminal: TERM6789
                    otpGeneratedBy: ''
                    branchId: 'cogito                              '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: dd7666e4-287b-45b8-8f89-7bb59422b867
                    internalCommerceId: 895
                    otpCode: $2b$10$g.YPwhc3DcvyTmZDZLTkV.Ac7LocTUlMl9g11jDyHkkHdLgqIQdZW
                    otpExpiresAt: '2025-07-18T19:01:14.663Z'
                    otpStatus: PENDING
                    apiKey: contra
                    commerceName: Elotes Dan
                  - _id: c9224731-644d-4533-a280-32ace66a5785
                    name: Mrs. Guadalupe Haley
                    model: commodi
                    serialNumber: urbs
                    warehouseManager: basium
                    systemChargeResponsible: utrum
                    arrivalTrackingGuide: deripio
                    parcelDistributor: caritas
                    arrivalDate: '2025-05-22T06:23:41.477Z'
                    chipSerialNumber: vigilo
                    chipTwoSerialNumber: tabella
                    imeiTerminal: volva
                    imeiTwoTerminal: corporis
                    location: commerce
                    status: PENDING
                    pending: false
                    active: true
                    createdAt: '2025-05-22T03:01:07.740Z'
                    updatedAt: '2025-05-22T19:53:59.499Z'
                    id: 678
                    ID_Terminal: TERM9433
                    otpGeneratedBy: ''
                    branchId: 'antepono                            '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: 'officia                             '
                    internalCommerceId: 61
                    otpCode: mollitia
                    otpExpiresAt: '2025-05-22T03:57:43.883Z'
                    otpStatus: abscido
                    apiKey: asper
                    commerceName: Elotes Dan
                  - _id: bc103e7b-c763-488d-81b3-928f31feb070
                    name: Dr. Lindsay Spinka
                    model: pel
                    serialNumber: patior
                    warehouseManager: deprimo
                    systemChargeResponsible: demulceo
                    arrivalTrackingGuide: auditor
                    parcelDistributor: animi
                    arrivalDate: '2025-05-22T00:28:34.293Z'
                    chipSerialNumber: armarium
                    chipTwoSerialNumber: voluptate
                    imeiTerminal: angelus
                    imeiTwoTerminal: vere
                    location: commerce
                    status: REFUNDED
                    pending: false
                    active: true
                    createdAt: '2025-05-22T01:55:58.541Z'
                    updatedAt: '2025-05-22T13:00:55.729Z'
                    id: 164
                    ID_Terminal: TERM6507
                    otpGeneratedBy: ''
                    branchId: 'urbanus                             '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: 'attollo                             '
                    internalCommerceId: 690
                    otpCode: viridis
                    otpExpiresAt: '2025-05-22T16:33:42.687Z'
                    otpStatus: dapifer
                    apiKey: spiritus
                    commerceName: Elotes Dan
                  - _id: 1296607c-d89f-4db2-b965-0e2baf875c99
                    name: Miss Hope Jaskolski
                    model: careo
                    serialNumber: voco
                    warehouseManager: carmen
                    systemChargeResponsible: suffoco
                    arrivalTrackingGuide: chirographum
                    parcelDistributor: culpa
                    arrivalDate: '2025-05-22T02:40:51.017Z'
                    chipSerialNumber: anser
                    chipTwoSerialNumber: enim
                    imeiTerminal: arguo
                    imeiTwoTerminal: tergiversatio
                    location: commerce
                    status: FAILED
                    pending: true
                    active: true
                    createdAt: '2025-05-22T01:05:27.852Z'
                    updatedAt: '2025-05-22T20:16:03.739Z'
                    id: 190
                    ID_Terminal: TERM9809
                    otpGeneratedBy: ''
                    branchId: 'vapulus                             '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: 'candidus                            '
                    internalCommerceId: 13
                    otpCode: decet
                    otpExpiresAt: '2025-05-22T02:17:59.864Z'
                    otpStatus: acceptus
                    apiKey: tricesimus
                    commerceName: Elotes Dan
                  - _id: 47945f9e-9169-4e9c-9334-d1074210c532
                    name: Oscar Lind
                    model: deludo
                    serialNumber: aranea
                    warehouseManager: clamo
                    systemChargeResponsible: odio
                    arrivalTrackingGuide: trans
                    parcelDistributor: studio
                    arrivalDate: '2025-05-22T00:18:29.904Z'
                    chipSerialNumber: adinventitias
                    chipTwoSerialNumber: cetera
                    imeiTerminal: acceptus
                    imeiTwoTerminal: cognatus
                    location: commerce
                    status: REFUNDED
                    pending: true
                    active: true
                    createdAt: '2025-05-21T23:09:06.027Z'
                    updatedAt: '2025-05-22T09:55:40.570Z'
                    id: 325
                    ID_Terminal: TERM4093
                    otpGeneratedBy: ''
                    branchId: 'sono                                '
                    commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                    franchise: 'distinctio                          '
                    internalCommerceId: 299
                    otpCode: condico
                    otpExpiresAt: '2025-05-22T04:16:47.908Z'
                    otpStatus: ocer
                    apiKey: delectatio
                    commerceName: Elotes Dan
        '400':
          description: Filtros requeridos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: Los filtros de búsqueda son requeridos
                  statusCode:
                    type: integer
                    example: 400
                  code:
                    type: string
                    example: MISSING_FILTERS
              example:
                isOperational: true
                name: Los filtros de búsqueda son requeridos
                statusCode: 400
                code: MISSING_FILTERS
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
                  code:
                    type: string
                    example: SERVER_ERROR
              example:
                message: Internal Server Error
                code: SERVER_ERROR
  /api/terminal/searchTerminals:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Buscar terminales por número de serie
      description: 'Busca terminales filtrando por un campo y su valor.

        '
      operationId: searchTerminals
      security:
      - Authorization: []
      parameters:
      - name: field
        in: query
        required: true
        schema:
          type: string
        description: Campo por el que se va a buscar (ej. serialNumber)
      - name: value
        in: query
        required: true
        schema:
          type: string
        description: Valor a buscar
      responses:
        '200':
          description: Terminales encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: b1224731-644d-4533-a280-32ace66a5785
                        name:
                          type: string
                          example: pocket
                        model:
                          type: string
                          example: max
                        serialNumber:
                          type: string
                          example: '123'
                        warehouseManager:
                          type: string
                          example: test
                        systemChargeResponsible:
                          type: string
                          example: test
                        arrivalTrackingGuide:
                          type: string
                          example: dhl
                        parcelDistributor:
                          type: string
                          example: dhl
                        arrivalDate:
                          type: string
                          format: date-time
                          example: '2025-07-17T05:00:00.000Z'
                        chipSerialNumber:
                          type: string
                          example: test
                        chipTwoSerialNumber:
                          type: string
                          example: test
                        imeiTerminal:
                          type: string
                          example: prueb
                        imeiTwoTerminal:
                          type: string
                          example: testp
                        location:
                          type: string
                          example: commerce
                        status:
                          type: string
                          example: COMPLETED
                        pending:
                          type: boolean
                          example: false
                        active:
                          type: boolean
                          example: true
                        createdAt:
                          type: string
                          format: date-time
                          example: '2025-07-17T20:10:08.025Z'
                        updatedAt:
                          type: string
                          format: date-time
                          example: '2025-07-17T20:10:08.025Z'
                        id:
                          type: integer
                          example: 502
                        ID_Terminal:
                          type: string
                          example: TERM56455
                        otpGeneratedBy:
                          type: string
                          example: ''
                        branchId:
                          type: string
                          example: 'testff                              '
                        commerce:
                          type: string
                          example: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                        franchise:
                          type: string
                          example: dd7666e4-287b-45b8-8f89-7bb59422b867
                        internalCommerceId:
                          type: integer
                          example: 544
                        otpCode:
                          type: string
                          example: mhyd
                        otpExpiresAt:
                          type: string
                          format: date-time
                          example: '2025-08-22T07:25:21.325Z'
                        otpStatus:
                          type: string
                          example: ggg
                        apiKey:
                          type: string
                          example: ggg
                        commerceInfo:
                          type: object
                          properties:
                            commerceName:
                              type: string
                              example: Elotes Dan
                            commerceInternalId:
                              type: string
                              example: '9416850'
                            commerceResponsible:
                              type: object
                              properties:
                                _id:
                                  type: string
                                  example: aec0c7e4-80c4-475a-8137-878fc34efee7
                                userId:
                                  type: string
                                  nullable: true
                                  example: null
                                name:
                                  type: string
                                  example: Dan
                                firstLastName:
                                  type: string
                                  example: Rojas
                                phone:
                                  type: string
                                  example: '333333333'
                                email:
                                  type: string
                                  example: daniel.rojas@lklpay.com.mx
                                secondLastName:
                                  type: string
                                  nullable: true
                                  example: null
                                countryCode:
                                  type: string
                                  nullable: true
                                  example: null
                        franchiseName:
                          type: object
                          properties:
                            name:
                              type: string
                              example: Jair Prueba
                            clabe:
                              type: string
                              example: '333333333333333333'
              examples:
                example-1:
                  value:
                    message: success
                    response:
                    - _id: b1224731-644d-4533-a280-32ace66a5785
                      name: pocket
                      model: max
                      serialNumber: '123'
                      warehouseManager: test
                      systemChargeResponsible: test
                      arrivalTrackingGuide: dhl
                      parcelDistributor: dhl
                      arrivalDate: '2025-07-17T05:00:00.000Z'
                      chipSerialNumber: test
                      chipTwoSerialNumber: test
                      imeiTerminal: prueb
                      imeiTwoTerminal: testp
                      location: commerce
                      status: COMPLETED
                      pending: false
                      active: true
                      createdAt: '2025-07-17T20:10:08.025Z'
                      updatedAt: '2025-07-17T20:10:08.025Z'
                      id: 502
                      ID_Terminal: TERM56455
                      otpGeneratedBy: ''
                      branchId: 'testff                              '
                      commerce: 91b0025f-d4ff-4531-b974-f965c5ef6fa4
                      franchise: dd7666e4-287b-45b8-8f89-7bb59422b867
                      internalCommerceId: 544
                      otpCode: mhyd
                      otpExpiresAt: '2025-08-22T07:25:21.325Z'
                      otpStatus: ggg
                      apiKey: ggg
                      commerceInfo:
                        commerceName: Elotes Dan
                        commerceInternalId: '9416850'
                        commerceResponsible:
                          _id: aec0c7e4-80c4-475a-8137-878fc34efee7
                          userId: null
                          name: Dan
                          firstLastName: Rojas
                          phone: '333333333'
                          email: daniel.rojas@lklpay.com.mx
                          secondLastName: null
                          countryCode: null
                      franchiseName:
                        name: Jair Prueba
                        clabe: '333333333333333333'
        '404':
          description: No se encontraron terminales
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: No se encontraron terminales
                  statusCode:
                    type: integer
                    example: 404
                  code:
                    type: string
                    example: UNEXPECTED_ERROR
              example:
                isOperational: true
                name: No se encontraron terminales
                statusCode: 404
                code: UNEXPECTED_ERROR
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: Error interno del servidor
                  statusCode:
                    type: integer
                    example: 500
                  code:
                    type: string
                    example: INTERNAL_ERROR
              example:
                isOperational: true
                name: Error interno del servidor
                statusCode: 500
                code: INTERNAL_ERROR
  /api/terminal/resume:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Obtener resumen de terminales
      description: 'Retorna un resumen agrupado de terminales según el filtro proporcionado.

        '
      operationId: getTerminalResume
      security:
      - Authorization: []
      parameters:
      - name: filter
        in: query
        required: true
        schema:
          type: string
        description: Filtro para el resumen (ej. warehouse)
      responses:
        '200':
          description: Resumen de terminales obtenido exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: pocket
                        total:
                          type: integer
                          example: 6
                        locations:
                          type: array
                          items:
                            type: string
                            example: commerce
              examples:
                ejemplo:
                  value:
                    message: success
                    response:
                    - _id: pocket
                      total: 6
                      locations:
                      - commerce
                      - warehouse
                      - warehouse
                      - warehouse
                      - franchise
                      - commerce
                    - _id: Miss Hope Jaskolski
                      total: 1
                      locations:
                      - commerce
                    - _id: Mrs. Guadalupe Haley
                      total: 1
                      locations:
                      - commerce
                    - _id: Miss Lisa Emard
                      total: 1
                      locations:
                      - commerce
                    - _id: Oscar Lind
                      total: 1
                      locations:
                      - commerce
                    - _id: Dr. Lindsay Spinka
                      total: 1
                      locations:
                      - commerce
        '404':
          description: No se encontró resumen de terminales
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: No se encontró resumen de terminales
                  statusCode:
                    type: integer
                    example: 404
                  code:
                    type: string
                    example: UNEXPECTED_ERROR
              example:
                isOperational: true
                name: No se encontró resumen de terminales
                statusCode: 404
                code: UNEXPECTED_ERROR
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: Error interno del servidor
                  statusCode:
                    type: integer
                    example: 500
                  code:
                    type: string
                    example: INTERNAL_ERROR
              example:
                isOperational: true
                name: Error interno del servidor
                statusCode: 500
                code: INTERNAL_ERROR
  /api/terminal/commerce/resetPasscode:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Resetear passcode de terminal
      description: 'Genera y asigna un nuevo passcode a la terminal de un comercio.

        Envía el passcode al correo electrónico registrado del comercio.

        Requiere token de autenticación de comercio (`Authorization: Bearer <token>`).

        '
      operationId: resetPasscodeCommerce
      security:
      - CommerceAuth: []
      requestBody:
        required: false
        description: No requiere body; la identificación se obtiene del token de comercio.
      responses:
        '200':
          description: Passcode reseteado exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  passcode:
                    type: string
                    description: Nuevo passcode generado para la terminal.
                    example: '849302'
              example:
                passcode: '849302'
        '400':
          description: Token de acceso inválido o ausente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
              example:
                error:
                  name: Se requiere un token de acceso válido
                  statusCode: 400
        '401':
          description: No se encontró email válido para el comercio.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: No se encontró email de restablecimiento de código
                      statusCode:
                        type: integer
                        example: 401
              example:
                error:
                  name: No se encontró email de restablecimiento de código
                  statusCode: 401
        '404':
          description: Terminal no encontrada para el comercio / serialNumber indicado
            en el token.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: No se encontró la terminal
                      statusCode:
                        type: integer
                        example: 404
              example:
                error:
                  name: No se encontró la terminal
                  statusCode: 404
        '500':
          description: Error interno o de base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Error en la base de datos
                      code:
                        type: integer
                        example: 11000
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/terminal/update:
    patch:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Actualizar terminal
      description: Actualiza información de una terminal (requiere token Backoffice).
      operationId: updateTerminal
      security:
      - Authorization: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - _id
              properties:
                _id:
                  type: string
                  description: ID de la terminal a actualizar
                  example: 352966107831386
                serialNumber:
                  type: string
                  example: 0821407462
                branchId:
                  type: string
                  example: cogito
                name:
                  type: string
                warehouseManager:
                  type: string
                systemChargeResponsible:
                  type: string
                arrivalTrackingGuide:
                  type: string
                parcelDistributor:
                  type: string
                arrivalDate:
                  type: string
                  format: date-time
                status:
                  type: string
                pending:
                  type: boolean
                active:
                  type: boolean
                model:
                  type: string
                chipSerialNumber:
                  type: string
                chipTwoSerialNumber:
                  type: string
                imeiTerminal:
                  type: string
                imeiTwoTerminal:
                  type: string
            example:
              _id: '352966107831386'
              serialNumber: 0821407462
              branchId: cogito
      responses:
        '200':
          description: Terminal actualizada exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  updated:
                    type: boolean
                    example: true
              example:
                message: success
                updated: true
        '500':
          description: Error interno o validaciones de negocio
          content:
            application/json:
              schema:
                oneOf:
                - type: object
                  properties:
                    message:
                      type: string
                - type: object
                  properties:
                    error:
                      type: object
                      properties:
                        message:
                          type: string
                        code:
                          type: string
                    created:
                      type: boolean
              examples:
                terminalNotFound:
                  value:
                    message: 'TerminalNotFoundError: Terminals Error: Terminal with
                      criteria Active terminal with id 650b517f5e977545ad2e6f08 not
                      found'
                invalidJWT:
                  value:
                    error: 'message: JsonWebTokenError: invalid signature'
                invalidId:
                  value:
                    error:
                      message: ID inválido proporcionado
                      code: INVALID_OBJECT_ID
                    created: true
  /api/terminal/commerce/search:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Buscar terminales del comercio (autenticado)
      description: 'Devuelve las terminales del **comercio autenticado** (se toma
        de `Authorization: Bearer <token>`).

        Puedes filtrar por número de serie (búsqueda parcial y case-insensitive),
        nombre o ubicación (`location`).

        '
      operationId: searchTerminalsByCommerce
      security:
      - CommerceAuth: []
      parameters:
      - in: query
        name: ~serialNumber
        required: false
        allowReserved: true
        description: 'Búsqueda parcial (regex, case-insensitive) por número de serie
          de la terminal.

          Usa coincidencia contiene. Ejemplo: `~serialNumber=08214` devuelve terminales
          cuyo SN contiene "08214".

          '
        schema:
          type: string
        example: 08214
      - in: query
        name: name
        required: false
        description: Filtra por nombre exacto de la terminal.
        schema:
          type: string
        example: Ingenico Desk5000
      - in: query
        name: location
        required: false
        description: Ubicación de la terminal.
        schema:
          type: string
          enum:
          - WAREHOUSE
          - FRANCHISE
          - COMMERCE
        example: COMMERCE
      - in: query
        name: limit
        required: false
        description: Límite de resultados (por defecto 10).
        schema:
          type: integer
          minimum: 1
          maximum: 200
        example: 10
      responses:
        '200':
          description: Lista de terminales que pertenecen al comercio autenticado.
            Si no hay resultados, devuelve un arreglo vacío.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true
                  properties:
                    serialNumber:
                      type: string
                    commerce:
                      type: string
                      description: ID del comercio (owner de la terminal).
                    franchise:
                      type: string
                    name:
                      type: string
                    model:
                      type: string
                    status:
                      type: string
                    location:
                      type: string
                      enum:
                      - WAREHOUSE
                      - FRANCHISE
                      - COMMERCE
                    ID Terminal:
                      type: string
                      description: Campo textual tal cual en el modelo.
                    internalCommerceId:
                      type: string
                    active:
                      type: boolean
                    id:
                      type: string
                    imeiTerminal:
                      type: string
                    imeiTwoTerminal:
                      type: string
                    chipSerialNumber:
                      type: string
                    chipTwoSerialNumber:
                      type: string
                    commerceName:
                      type: string
                    commerceInfo:
                      type: object
                      properties:
                        commerceName:
                          type: string
                        commerceInternalId:
                          type: string
                        commerceResponsible:
                          type: string
                    franchiseName:
                      type: string
                    branchName:
                      type: string
              example:
              - serialNumber: 0821407462
                commerce: 64f9c1a4e5d4f5a8d929b4b2
                franchise: 64f9c1a4e5d4f5a8d929b4aa
                name: Ingenico Desk5000
                model: Desk5000
                status: ACTIVE
                location: COMMERCE
                internalCommerceId: COM-00123
                active: true
                id: TER-00004567
                imeiTerminal: '353490123456789'
                chipSerialNumber: '8934076501234567890'
                commerceName: Comercio Ejemplo SA de CV
                commerceInfo:
                  commerceName: Comercio Ejemplo SA de CV
                  commerceInternalId: COM-00123
                  commerceResponsible: Juan Pérez
                franchiseName: Franquicia Norte
                branchName: Sucursal Centro
              - serialNumber: 0821407001
                commerce: 64f9c1a4e5d4f5a8d929b4b2
                franchise: 64f9c1a4e5d4f5a8d929b4aa
                name: Ingenico Move2500
                model: Move2500
                status: ACTIVE
                location: COMMERCE
                internalCommerceId: COM-00123
                active: true
                id: TER-00004568
                imeiTerminal: '353490987654321'
                chipSerialNumber: '8934076500987654321'
                commerceName: Comercio Ejemplo SA de CV
                commerceInfo:
                  commerceName: Comercio Ejemplo SA de CV
                  commerceInternalId: COM-00123
                  commerceResponsible: Juan Pérez
                franchiseName: Franquicia Norte
                branchName: Sucursal Centro
        '400':
          description: Token ausente o inválido (middleware de comercio).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
              example:
                error:
                  name: Se requiere un token de acceso válido
                  statusCode: 400
        '401':
          description: Token expirado u otro error de autenticación propagado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno o de base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Error en la base de datos
                      code:
                        type: integer
                        example: 11000
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/terminal/franchise/search:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Buscar terminales de la franquicia (autenticado)
      description: 'Devuelve las terminales asociadas a la **franquicia autenticada**
        (obtenida del token Bearer).

        Permite filtrar por número de serie parcial (regex), nombre y ubicación (`location`).

        '
      operationId: searchTerminalsByFranchise
      security:
      - FranchiseAuth: []
      parameters:
      - in: query
        name: ~serialNumber
        required: false
        allowReserved: true
        description: 'Búsqueda parcial (regex, case-insensitive) por número de serie.

          Ejemplo: `~serialNumber=08214` devuelve terminales cuyo SN contenga "08214".

          '
        schema:
          type: string
        example: 08214
      - in: query
        name: name
        required: false
        description: Filtra por nombre exacto de la terminal.
        schema:
          type: string
        example: Ingenico Desk5000
      - in: query
        name: location
        required: false
        description: Ubicación de la terminal.
        schema:
          type: string
          enum:
          - WAREHOUSE
          - FRANCHISE
          - COMMERCE
        example: FRANCHISE
      - in: query
        name: limit
        required: false
        description: Límite de resultados (por defecto 10).
        schema:
          type: integer
          minimum: 1
          maximum: 200
        example: 10
      responses:
        '200':
          description: Lista de terminales que pertenecen a la franquicia autenticada.
            Si no hay resultados, devuelve un arreglo vacío.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true
                  properties:
                    serialNumber:
                      type: string
                    commerce:
                      type: string
                      description: ID del comercio asignado.
                    franchise:
                      type: string
                    name:
                      type: string
                    model:
                      type: string
                    status:
                      type: string
                    location:
                      type: string
                      enum:
                      - WAREHOUSE
                      - FRANCHISE
                      - COMMERCE
                    ID Terminal:
                      type: string
                    internalCommerceId:
                      type: string
                    active:
                      type: boolean
                    id:
                      type: string
                    imeiTerminal:
                      type: string
                    imeiTwoTerminal:
                      type: string
                    chipSerialNumber:
                      type: string
                    chipTwoSerialNumber:
                      type: string
                    commerceName:
                      type: string
                    commerceInfo:
                      type: object
                      properties:
                        commerceName:
                          type: string
                        commerceInternalId:
                          type: string
                        commerceResponsible:
                          type: string
                    franchiseName:
                      type: string
                    branchName:
                      type: string
              example:
              - serialNumber: 0821407462
                commerce: 64f9c1a4e5d4f5a8d929b4b2
                franchise: 64f9c1a4e5d4f5a8d929b4aa
                name: Ingenico Desk5000
                model: Desk5000
                status: ACTIVE
                location: FRANCHISE
                internalCommerceId: COM-00123
                active: true
                id: TER-00004567
                imeiTerminal: '353490123456789'
                chipSerialNumber: '8934076501234567890'
                commerceName: Comercio Ejemplo SA de CV
                commerceInfo:
                  commerceName: Comercio Ejemplo SA de CV
                  commerceInternalId: COM-00123
                  commerceResponsible: Juan Pérez
                franchiseName: Franquicia Norte
                branchName: Sucursal Centro
        '400':
          description: Token ausente o inválido (middleware de franquicia).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
              example:
                error:
                  name: Se requiere un token de acceso válido
                  statusCode: 400
        '401':
          description: Token expirado u otro error de autenticación propagado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno o de base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Error en la base de datos
                      code:
                        type: integer
                        example: 11000
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/terminal/generateOTP:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Generar OTP para terminal
      description: 'Genera un código OTP para la terminal especificada por número
        de serie y comercio. Requiere autenticación con token de backoffice.

        '
      operationId: generateTerminalOtp
      security:
      - Authorization: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - serialNumber
              - commerceId
              properties:
                serialNumber:
                  type: string
                  example: '123'
                commerceId:
                  type: string
                  example: dd7666e4-287b-45b8-8f89-7bb59422b867
            example:
              serialNumber: '123'
              commerceId: dd7666e4-287b-45b8-8f89-7bb59422b867
      responses:
        '200':
          description: OTP generado exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  otp:
                    type: string
                    example: X2M9K
                  expiresAt:
                    type: string
                    format: date-time
                    example: '2025-08-22T07:25:21.325Z'
                  serialNumber:
                    type: string
                    example: '123'
              example:
                message: success
                otp: X2M9K
                expiresAt: '2025-08-22T07:25:21.325Z'
                serialNumber: '123'
        '400':
          description: Petición incorrecta o validación fallida.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Validation failed
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        property:
                          type: string
                          example: commerceId
                        constraints:
                          type: object
                          additionalProperties: true
              example:
                message: Validation failed
                errors:
                - property: commerceId
                  constraints:
                    whitelistValidation: property commerceId should not exist
        '401':
          description: No autorizado (token inválido o ausente).
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
                  code:
                    type: string
                    example: UNAUTHORIZED
              example:
                message: Unauthorized
                code: UNAUTHORIZED
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
                  code:
                    type: string
                    example: SERVER_ERROR
              example:
                message: Internal Server Error
                code: SERVER_ERROR
  /api/terminal/assignApiKeyWithOtp:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Asignar API Key usando OTP
      description: 'Asigna una API Key a una terminal usando OTP. Requiere autenticación
        con token de backoffice.

        '
      operationId: assignApiKeyWithOtp
      security:
      - Authorization: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - serialNumber
              - commerceInternalId
              - otp
              properties:
                serialNumber:
                  type: string
                  example: 0821407546
                commerceInternalId:
                  type: string
                  example: 650b6d827b7153db1997c088
                otp:
                  type: string
                  example: QFFF44
            example:
              serialNumber: 0821407546
              commerceInternalId: 650b6d827b7153db1997c088
              otp: QFFF44
      responses:
        '200':
          description: API Key asignada exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  apiKey:
                    type: string
                    example: 9b8f2a62-5d5d-42ba-8c01-9ab548efbe41
                  serialNumber:
                    type: string
                    example: 0821407546
                  commerceInternalId:
                    type: string
                    example: 650b6d827b7153db1997c088
              example:
                message: success
                apiKey: 9b8f2a62-5d5d-42ba-8c01-9ab548efbe41
                serialNumber: 0821407546
                commerceInternalId: 650b6d827b7153db1997c088
        '400':
          description: Petición incorrecta o validación fallida.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Validation failed
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        property:
                          type: string
                          example: otp
                        constraints:
                          type: object
                          additionalProperties: true
              example:
                message: Validation failed
                errors:
                - property: otp
                  constraints:
                    isNotEmpty: OTP is required
        '401':
          description: No autorizado (token inválido o ausente).
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
                  code:
                    type: string
                    example: UNAUTHORIZED
              example:
                message: Unauthorized
                code: UNAUTHORIZED
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
                  code:
                    type: string
                    example: SERVER_ERROR
              example:
                message: Internal Server Error
                code: SERVER_ERROR
  /api/terminal/resetApiKey:
    post:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / terminales
      summary: Resetear API Key de terminal
      description: 'Restaura/genera una nueva API Key para la terminal indicada por
        su serialNumber. Requiere token de backoffice.

        '
      operationId: resetApiKey
      security:
      - Authorization: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - serialNumber
              properties:
                serialNumber:
                  type: string
                  example: '1234567899'
            example:
              serialNumber: '1234567899'
      responses:
        '200':
          description: API Key reseteada exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      apiKey:
                        type: string
                        example: api-b3d2b867-ba2d-4ea1-a37f-5c0f0217fb10-2h7a1u
                      data:
                        type: object
                        properties:
                          _id:
                            type: string
                            example: 650b517f5e977545ad2e6f08
                          name:
                            type: string
                            example: pocket
                          serialNumber:
                            type: string
                            example: '1234567899'
                          warehouseManager:
                            type: string
                            example: '1234'
                          systemChargeResponsible:
                            type: string
                            example: '2345'
                          arrivalTrackingGuide:
                            type: string
                            example: '234'
                          parcelDistributor:
                            type: string
                            example: '2345'
                          arrivalDate:
                            type: string
                            format: date-time
                            example: '2023-09-20T00:00:00.000Z'
                          otpGeneratedBy:
                            type: array
                            items:
                              type: string
                            example: []
                          location:
                            type: string
                            example: commerce
                          status:
                            type: string
                            example: Sin software
                          pending:
                            type: boolean
                            example: false
                          active:
                            type: boolean
                            example: true
                          createdAt:
                            type: string
                            format: date-time
                            example: '2023-09-20T20:09:35.858Z'
                          updatedAt:
                            type: string
                            format: date-time
                            example: '2025-07-21T21:53:35.168Z'
                          model:
                            type: string
                            example: D180
                          id:
                            type: integer
                            example: 9
                          __v:
                            type: integer
                            example: 0
                          apiKey:
                            type: string
                            example: $2b$05$.sB3uzWCfI2dWE7iEKj9GuEd/4hyJ3f3e0wTfTz7HnPkVHYWqop7S
                          ID_Terminal:
                            type: string
                            example: THESTPV1+0000009
                          internalCommerceId:
                            type: integer
                            example: 10
                          chipSerialNumber:
                            type: string
                            example: a
                          chipTwoSerialNumber:
                            type: string
                            example: rr
                          imeiTerminal:
                            type: string
                            example: ''
                          imeiTwoTerminal:
                            type: string
                            example: ''
                          operativeMode:
                            type: string
                            example: retail
                          branchId:
                            type: string
                            example: 6848ddd6af2ee244b2270106
                          commerce:
                            type: string
                            example: 65089340b635762563c9f92d
              example:
                message: success
                response:
                  apiKey: api-b3d2b867-ba2d-4ea1-a37f-5c0f0217fb10-2h7a1u
                  data:
                    _id: 650b517f5e977545ad2e6f08
                    name: pocket
                    serialNumber: '1234567899'
                    warehouseManager: '1234'
                    systemChargeResponsible: '2345'
                    arrivalTrackingGuide: '234'
                    parcelDistributor: '2345'
                    arrivalDate: '2023-09-20T00:00:00.000Z'
                    otpGeneratedBy: []
                    location: commerce
                    status: Sin software
                    pending: false
                    active: true
                    createdAt: '2023-09-20T20:09:35.858Z'
                    updatedAt: '2025-07-21T21:53:35.168Z'
                    model: D180
                    id: 9
                    __v: 0
                    apiKey: $2b$05$.sB3uzWCfI2dWE7iEKj9GuEd/4hyJ3f3e0wTfTz7HnPkVHYWqop7S
                    ID_Terminal: THESTPV1+0000009
                    internalCommerceId: 10
                    chipSerialNumber: a
                    chipTwoSerialNumber: rr
                    imeiTerminal: ''
                    imeiTwoTerminal: ''
                    operativeMode: retail
                    branchId: 6848ddd6af2ee244b2270106
                    commerce: 65089340b635762563c9f92d
        '400':
          description: Petición incorrecta o validación fallida.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        property:
                          type: string
                        constraints:
                          type: object
                          additionalProperties: true
              example:
                message: Validation failed
                errors:
                - property: serialNumber
                  constraints:
                    isNotEmpty: serialNumber should not be empty
                    isString: serialNumber must be a string
        '404':
          description: Terminal no encontrada.
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: Terminal no encontrada
                  statusCode:
                    type: integer
                    example: 404
                  code:
                    type: string
                    example: UNEXPECTED_ERROR
              example:
                isOperational: true
                name: Terminal no encontrada
                statusCode: 404
                code: UNEXPECTED_ERROR
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
              example:
                message: Internal Server Error
  /api/terminal/{id}:
    delete:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / terminales
      summary: Eliminar terminal
      description: 'Marca una terminal como eliminada (soft delete: active=false,
        deletedAt=now).

        Requiere token Backoffice.

        '
      operationId: deleteTerminal
      security:
      - BackofficeAuth: []
      parameters:
      - in: path
        name: id
        required: true
        description: ID de la terminal a eliminar.
        schema:
          type: string
          example: 66d0f0c2f2a4b3f5c1a2b3c4
      responses:
        '200':
          description: Terminal eliminada exitosamente (soft delete).
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                properties:
                  _id:
                    type: string
                  name:
                    type: string
                  serialNumber:
                    type: string
                  active:
                    type: boolean
                  deletedAt:
                    type: string
                    format: date-time
              example:
                _id: 66d0f0c2f2a4b3f5c1a2b3c4
                name: Ingenico Desk5000
                serialNumber: 0821407462
                active: false
                deletedAt: '2025-08-29T15:45:00.000Z'
        '400':
          description: Parámetro inválido (ObjectId malformado).
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                  error:
                    type: object
                    properties:
                      message:
                        type: string
              example:
                code: INVALID_OBJECT_ID
                error:
                  message: ID inválido proporcionado
        '401':
          description: Token inválido o expirado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                      message:
                        type: string
              example:
                code: ACCESS_TOKEN_EXPIRED
                error:
                  name: TokenExpiredError
                  message: jwt expired
        '404':
          description: No se encontró la terminal.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                      statusCode:
                        type: integer
              example:
                error:
                  name: Terminal no encontrada
                  statusCode: 404
        '500':
          description: Error interno o base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                      code:
                        type: integer
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/transaction/tpv/getTransactions:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / transacciones
      summary: Obtener transacciones por terminal
      description: 'Devuelve las transacciones asociadas al terminal físico (TPV)
        usando su identificador. Requiere token de backoffice.

        '
      operationId: getTransactionsByTpv
      security:
      - Authorization: []
      parameters:
      - name: idTerminal
        in: query
        description: Identificador del terminal físico (TPV)
        required: true
        schema:
          type: string
          example: THESTPV1+0000010
      responses:
        '200':
          description: Transacciones obtenidas correctamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      transactions:
                        type: array
                        items: {}
              examples:
                sin-transacciones:
                  value:
                    message: success
                    response:
                      transactions: []
        '400':
          description: Petición incorrecta o parámetros inválidos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Validation failed
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        property:
                          type: string
                          example: idTerminal
                        constraints:
                          type: object
                          properties:
                            isNotEmpty:
                              type: string
                              example: idTerminal should not be empty
                            isString:
                              type: string
                              example: idTerminal must be a string
              example:
                message: Validation failed
                errors:
                - property: idTerminal
                  constraints:
                    isNotEmpty: idTerminal should not be empty
                    isString: idTerminal must be a string
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
              example:
                message: Internal Server Error
  /api/transaction/getTransactionById/{id}:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones
      summary: Buscar transacciones por ID
      description: 'Retorna transacciones asociadas al comercio autenticado cuyo campo
        "ID Transaction" coincida (parcial o completo) con el parametro "id" de la
        URL. Se pueden aplicar filtros de marca ("brand") y paginacion ("start", "end").
        Requiere token de comercio (commerceMiddleware).

        '
      operationId: getTransactionsById
      security:
      - CommerceAuth: []
      parameters:
      - name: id
        in: path
        required: true
        description: Identificador de la transaccion (busqueda parcial o completa).
        schema:
          type: string
        example: ECOM15885164
      - name: start
        in: query
        required: false
        description: 'Indice inicial para paginacion (default: 0).'
        schema:
          type: integer
        example: 0
      - name: end
        in: query
        required: false
        description: 'Indice final para paginacion (default: 10 registros).'
        schema:
          type: integer
        example: 10
      - name: brand
        in: query
        required: false
        description: Marca de tarjeta. Internamente se transforma en regex con getCardBrandRegex.
        schema:
          type: string
        example: VISA
      responses:
        '200':
          description: Lista de transacciones encontradas para el comercio autenticado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      count:
                        type: integer
                        description: Numero total de transacciones encontradas.
                        example: 2
                      transactions:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: 684b6874931d5a948b01c189
                            ID Transaction:
                              type: string
                              example: ECOM15885164
                            Amount:
                              type: number
                              example: 1000
                            Application PAN:
                              type: string
                              example: '************4242'
                            Cardholder Name:
                              type: string
                              example: Juan Perez
                            Cardholder Email:
                              type: string
                              example: juan.perez@email.com
                            Transaction Date:
                              type: string
                              example: '250612'
                            Transaction Time:
                              type: string
                              example: '175324'
                            comission:
                              type: number
                              example: 70
                            iva:
                              type: number
                              example: 11.2
                            toDeposit:
                              type: number
                              example: 918.8
                            transactionStatus:
                              type: string
                              example: approved
                            type:
                              type: string
                              example: e-commerce
              examples:
                ejemplo:
                  summary: Respuesta con dos transacciones encontradas
                  value:
                    message: success
                    response:
                      count: 2
                      transactions:
                      - _id: 684b6874931d5a948b01c189
                        ID Transaction: ECOM15885164
                        Amount: 1000
                        Application PAN: '************4242'
                        Cardholder Name: Juan Perez
                        Cardholder Email: juan.perez@email.com
                        Transaction Date: '250612'
                        Transaction Time: '175324'
                        comission: 70
                        iva: 11.2
                        toDeposit: 918.8
                        transactionStatus: approved
                        type: e-commerce
                      - _id: 684b6852931d5a948b01c183
                        ID Transaction: ECOM62191159
                        Amount: 500
                        Application PAN: '************1111'
                        Cardholder Name: Maria Lopez
                        Cardholder Email: maria.lopez@email.com
                        Transaction Date: '250610'
                        Transaction Time: '114500'
                        comission: 35
                        iva: 5.6
                        toDeposit: 459.4
                        transactionStatus: approved
                        type: pos
        '400':
          description: Token invalido o parametros incorrectos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso valido
                      statusCode:
                        type: integer
                        example: 400
        '404':
          description: No se encontraron transacciones con ese criterio.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No se encontraron transacciones
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/detail/{id}:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones
      summary: Obtener detalle de transacción
      description: 'Retorna la información detallada de una transacción específica,
        perteneciente al comercio autenticado. Requiere **token de comercio** (`commerceMiddleware`).

        '
      operationId: getTransactionDetail
      security:
      - CommerceAuth: []
      parameters:
      - name: id
        in: path
        required: true
        description: Identificador único de la transacción (`_id` en base de datos).
        schema:
          type: string
        example: 684b6874931d5a948b01c189
      responses:
        '200':
          description: Detalle de la transacción recuperado exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: 684b6874931d5a948b01c189
                      ID Transaction:
                        type: string
                        example: ECOM15885164
                      Amount:
                        type: number
                        example: 1000
                      Application PAN:
                        type: string
                        example: '************4242'
                      Cardholder Name:
                        type: string
                        example: Juan Pérez
                      Cardholder Email:
                        type: string
                        example: juan.perez@email.com
                      Transaction Date:
                        type: string
                        example: '250612'
                      Transaction Time:
                        type: string
                        example: '175324'
                      comission:
                        type: number
                        example: 70
                      iva:
                        type: number
                        example: 11.2
                      toDeposit:
                        type: number
                        example: 918.8
                      transactionStatus:
                        type: string
                        example: approved
                      type:
                        type: string
                        example: e-commerce
              examples:
                ejemplo:
                  summary: Ejemplo de respuesta exitosa
                  value:
                    message: success
                    response:
                      _id: 684b6874931d5a948b01c189
                      ID Transaction: ECOM15885164
                      Amount: 1000
                      Application PAN: '************4242'
                      Cardholder Name: Juan Pérez
                      Cardholder Email: juan.perez@email.com
                      Transaction Date: '250612'
                      Transaction Time: '175324'
                      comission: 70
                      iva: 11.2
                      toDeposit: 918.8
                      transactionStatus: approved
                      type: e-commerce
        '400':
          description: Token inválido o ausente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
        '404':
          description: No se encontró la transacción para el comercio autenticado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Detalles no encontrados
                      statusCode:
                        type: integer
                        example: 404
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/admin/approvedAndCancelled:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones
      summary: Consultar transacciones aprobadas y canceladas del día
      description: 'Retorna las transacciones **aprobadas** y **canceladas** del día
        actual, filtradas opcionalmente por usuario y tipo. Requiere autenticación
        con **token de administrador** (`adminAuthMiddleware`).

        '
      operationId: getApprovedAndCancelledTransactions
      security:
      - AdminAuth: []
      parameters:
      - name: user
        in: query
        required: false
        description: ID del comercio a filtrar (si no se envía, trae todos).
        schema:
          type: string
          example: 667f41ae5bd41914e6ab1dba
      - name: type
        in: query
        required: false
        description: Tipo de transacción (por ejemplo, `e-commerce`, `tpv`, etc).
        schema:
          type: string
          example: e-commerce
      responses:
        '200':
          description: Listado de transacciones aprobadas y canceladas del día actual.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      transactionsApprovedToday:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: 684b6874931d5a948b01c189
                            ID Transaction:
                              type: string
                              example: ECOM15885164
                            Amount:
                              type: number
                              example: 1000
                            Transaction Date:
                              type: string
                              example: '250612'
                            iva:
                              type: number
                              example: 11.2
                            comission:
                              type: number
                              example: 70
                            toDeposit:
                              type: number
                              example: 918.8
                            type:
                              type: string
                              example: e-commerce
                            transactionStatus:
                              type: string
                              example: approved
                      transactionsCancelledToday:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: 684b6852931d5a948b01c183
                            ID Transaction:
                              type: string
                              example: ECOM62191159
                            Amount:
                              type: number
                              example: 500
                            Transaction Date:
                              type: string
                              example: '250612'
                            iva:
                              type: number
                              example: 5.6
                            comission:
                              type: number
                              example: 35
                            toDeposit:
                              type: number
                              example: 459.4
                            type:
                              type: string
                              example: e-commerce
                            transactionStatus:
                              type: string
                              example: cancelled
              examples:
                ejemplo:
                  summary: Ejemplo de respuesta
                  value:
                    message: success
                    response:
                      transactionsApprovedToday:
                      - _id: 684b6874931d5a948b01c189
                        ID Transaction: ECOM15885164
                        Amount: 1000
                        Transaction Date: '250612'
                        iva: 11.2
                        comission: 70
                        toDeposit: 918.8
                        type: e-commerce
                        transactionStatus: approved
                      transactionsCancelledToday:
                      - _id: 684b6852931d5a948b01c183
                        ID Transaction: ECOM62191159
                        Amount: 500
                        Transaction Date: '250612'
                        iva: 5.6
                        comission: 35
                        toDeposit: 459.4
                        type: e-commerce
                        transactionStatus: cancelled
        '400':
          description: Token inválido o faltante.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
        '500':
          description: Error interno del servidor.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/admin/getTransactionById:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Obtener transacción por ID (admin)
      description: 'Devuelve el documento de la transacción cuyo **"ID Transaction"**
        coincide exactamente con `id`.

        Si no existe, responde **200** con `response: null`.

        No requiere autenticación (según el router compartido).

        '
      operationId: getTransactionByIdAdmin
      parameters:
      - in: query
        name: id
        required: true
        description: Valor exacto del campo **"ID Transaction"** a buscar.
        schema:
          type: string
        example: ECOM15885164
      responses:
        '200':
          description: Transacción encontrada o `null` si no hay coincidencia.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    oneOf:
                    - type: object
                      additionalProperties: true
                      properties:
                        _id:
                          type: string
                          example: 684b6874931d5a948b01c189
                        ID Transaction:
                          type: string
                          example: ECOM15885164
                        Amount:
                          type: number
                          example: 1000
                        Application PAN:
                          type: string
                          example: '************4242'
                        Transaction Date:
                          type: string
                          example: '250612'
                        Transaction Time:
                          type: string
                          example: '175324'
                        comission:
                          type: number
                          example: 70
                        iva:
                          type: number
                          example: 11.2
                        toDeposit:
                          type: number
                          example: 918.8
                        transactionStatus:
                          type: string
                          example: approved
                        type:
                          type: string
                          example: e-commerce
                    - type: 'null'
              examples:
                encontrada:
                  summary: Transacción encontrada
                  value:
                    message: success
                    response:
                      _id: 684b6874931d5a948b01c189
                      ID Transaction: ECOM15885164
                      Amount: 1000
                      Application PAN: '************4242'
                      Transaction Date: '250612'
                      Transaction Time: '175324'
                      comission: 70
                      iva: 11.2
                      toDeposit: 918.8
                      transactionStatus: approved
                      type: e-commerce
                no_encontrada:
                  summary: Sin coincidencias (response nulo)
                  value:
                    message: success
                    response: null
        '500':
          description: Error interno al consultar la transacción.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/backoffice/search:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Buscar transacciones (Backoffice)
      description: 'Busca transacciones desde Backoffice. Requiere token Bearer de
        Backoffice.

        Soporta filtros por campo, búsqueda parcial (~), comparadores (<, >) y arreglos
        (múltiples valores).

        Si no hay resultados, devuelve un arreglo vacío.

        '
      operationId: searchTransactionsBackoffice
      security:
      - BackofficeAuth: []
      parameters:
      - in: query
        name: ~ID Transaction
        required: false
        allowReserved: true
        description: Búsqueda parcial por ID de transacción.
        schema:
          type: string
        example: '000123'
      - in: query
        name: ID Transaction
        required: false
        description: Búsqueda exacta por ID de transacción.
        schema:
          type: string
        example: TRX-00012345
      - in: query
        name: commerce
        required: false
        description: Filtrar por ID(s) de comercio. Puede repetirse para múltiples
          valores.
        schema:
          type: array
          items:
            type: string
        style: form
        explode: true
        examples:
          uno:
            value:
            - 64f9c1a4e5d4f5a8d929b4b2
          varios:
            value:
            - 64f9c1a4e5d4f5a8d929b4b2
            - 64f9c1a4e5d4f5a8d929b4c0
      - in: query
        name: processor
        required: false
        description: Procesador de la transacción.
        schema:
          type: string
        example: TEF
      - in: query
        name: transactionStatus
        required: false
        description: Estado(s) de la transacción. Repite el parámetro para varios
          estados.
        schema:
          type: array
          items:
            type: string
        style: form
        explode: true
        examples:
          multiple:
            value:
            - APPROVED
            - CANCELED
      - in: query
        name: Transaction Date
        required: false
        description: Fecha exacta (YYYY-MM-DD).
        schema:
          type: string
          format: date
        example: '2025-08-28'
      - in: query
        name: '>Transaction Date'
        required: false
        description: Fecha mayor que (YYYY-MM-DD).
        schema:
          type: string
          format: date
        example: '2025-08-01'
      - in: query
        name: <Transaction Date
        required: false
        description: Fecha menor que (YYYY-MM-DD).
        schema:
          type: string
          format: date
        example: '2025-08-31'
      - in: query
        name: Transaction Time
        required: false
        description: Hora exacta (HH:mm:ss).
        schema:
          type: string
        example: '14:30:00'
      - in: query
        name: Amount
        required: false
        description: Monto exacto.
        schema:
          type: number
          format: double
        example: 150.75
      - in: query
        name: '>Amount'
        required: false
        description: Monto mayor que.
        schema:
          type: number
          format: double
        example: 100
      - in: query
        name: <Amount
        required: false
        description: Monto menor que.
        schema:
          type: number
          format: double
        example: 500
      - in: query
        name: ID Afiliate
        required: false
        description: ID del afiliado.
        schema:
          type: string
        example: AFI-001
      - in: query
        name: tefStatus
        required: false
        description: Estado TEF.
        schema:
          type: string
        example: OK
      - in: query
        name: depositStatus
        required: false
        description: Estado de depósito.
        schema:
          type: string
        example: PENDING
      - in: query
        name: operationType
        required: false
        description: Tipo de operación.
        schema:
          type: string
        example: SALE
      - in: query
        name: limit
        required: false
        description: Límite de resultados (default 10).
        schema:
          type: integer
          minimum: 1
          maximum: 500
        example: 10
      - in: query
        name: populated
        required: false
        description: 'Si es 1 (default), devuelve datos enriquecidos (commerceName,
          branchName, etc.).

          Si es 0, devuelve los campos crudos del modelo.

          '
        schema:
          type: integer
          enum:
          - 0
          - 1
        example: 1
      - in: query
        name: size
        required: false
        description: 'Si es `small`, solo devuelve un subconjunto de campos (commerce,
          ID Transaction, Amount, Transaction Date, Transaction Time).

          Cualquier otro valor devuelve el documento completo (salvo `active` y `__v`).

          '
        schema:
          type: string
          enum:
          - small
          - full
        example: small
      - in: query
        name: fields
        required: false
        description: 'Lista de campos específicos a devolver. Si se especifica, tiene
          prioridad sobre `size`.

          Repetir el parámetro para múltiples campos.

          '
        schema:
          type: array
          items:
            type: string
        style: form
        explode: true
        examples:
          ejemplo:
            value:
            - commerce
            - ID Transaction
            - Amount
            - Transaction Date
      responses:
        '200':
          description: Resultados de la búsqueda. Si no hay coincidencias, devuelve
            `[]`.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true
                  properties:
                    commerce:
                      type: string
                    franchiseId:
                      type: string
                    branchId:
                      type: string
                    ID Transaction:
                      type: string
                    Amount:
                      type: number
                    Transaction Date:
                      type: string
                    Transaction Time:
                      type: string
                    processor:
                      type: string
                    transactionStatus:
                      type: string
                    tefStatus:
                      type: string
                    depositStatus:
                      type: string
                    operationType:
                      type: string
                    commerceName:
                      type: string
                    franchiseName:
                      type: string
                    branchName:
                      type: string
                    commerceInfo:
                      type: object
                      properties:
                        commerceName:
                          type: string
                        commerceInternalId:
                          type: string
                        commerceResponsible:
                          type: string
                    branchInfo:
                      type: object
              examples:
                small:
                  summary: Selección `small`
                  value:
                  - commerce: 64f9c1a4e5d4f5a8d929b4b2
                    ID Transaction: TRX-00012345
                    Amount: 150.75
                    Transaction Date: '2025-08-28'
                    Transaction Time: '14:30:00'
                  - commerce: 64f9c1a4e5d4f5a8d929b4b2
                    ID Transaction: TRX-00012346
                    Amount: 220
                    Transaction Date: '2025-08-28'
                    Transaction Time: '15:05:10'
                populated:
                  summary: Resultado enriquecido (`populated=1`)
                  value:
                  - commerce: 64f9c1a4e5d4f5a8d929b4b2
                    franchiseId: 64f9c1a4e5d4f5a8d929b4aa
                    branchId: 64f9c1a4e5d4f5a8d929b4bb
                    ID Transaction: TRX-00012345
                    Amount: 150.75
                    Transaction Date: '2025-08-28'
                    Transaction Time: '14:30:00'
                    processor: TEF
                    transactionStatus: APPROVED
                    tefStatus: OK
                    depositStatus: DEPOSITED
                    operationType: SALE
                    commerceName: Comercio Ejemplo SA de CV
                    franchiseName: Franquicia Norte
                    branchName: Sucursal Centro
                    commerceInfo:
                      commerceName: Comercio Ejemplo SA de CV
                      commerceInternalId: COM-00123
                      commerceResponsible: Juan Pérez
                    branchInfo:
                      branchName: Sucursal Centro
        '400':
          description: Token ausente o inválido (middleware Backoffice).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
              example:
                error:
                  name: Se requiere un token de acceso válido
                  statusCode: 400
        '401':
          description: Token expirado u otro error de autenticación propagado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno o de base de datos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Error en la base de datos
                      code:
                        type: integer
                        example: 11000
              example:
                error:
                  message: Error en la base de datos
                  code: 11000
  /api/transaction/backoffice/getTransactions:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / transacciones / backoffice
      summary: Obtener transacciones (backoffice)
      description: 'Obtiene el listado de transacciones para backoffice con resumen.
        Requiere token de backoffice.

        '
      operationId: getTransactionsBackoffice
      security:
      - Authorization: []
      parameters:
      - name: startDate
        in: query
        description: Fecha de inicio (formato yymmdd)
        required: true
        schema:
          type: string
          example: '250704'
      - name: endDate
        in: query
        description: Fecha de fin (formato yymmdd)
        required: true
        schema:
          type: string
          example: '250804'
      - name: start
        in: query
        description: Inicio del paginado (índice)
        required: true
        schema:
          type: integer
          example: 0
      - name: end
        in: query
        description: Fin del paginado (índice)
        required: true
        schema:
          type: integer
          example: 10
      responses:
        '200':
          description: Listado y resumen de transacciones.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      transactions:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            ID Transaction:
                              type: string
                            type:
                              type: string
                            Amount:
                              type: number
                            Transaction Date:
                              type: string
                            Transaction Time:
                              type: string
                            transactionStatus:
                              type: string
                            commerce:
                              type: string
                            comission:
                              type: number
                            iva:
                              type: number
                            lklpayComission:
                              type: number
                            fixedComission:
                              type: number
                            tefStatus:
                              type: string
                            depositStatus:
                              type: string
                            authorization:
                              type: string
                            commerceName:
                              type: string
                      resume:
                        type: object
                        properties:
                          _id:
                            type: string
                            nullable: true
                          Amount:
                            type: number
                          Comission:
                            type: number
                          Deposit:
                            type: number
                          Sold:
                            type: integer
                          iva:
                            type: number
                          lklpayComission:
                            type: number
                          fixedComission:
                            type: number
                      total:
                        type: integer
              examples:
                ejemplo-completo:
                  value:
                    message: success
                    response:
                      transactions:
                      - _id: 684b6874931d5a948b01c189
                        ID Transaction: ECOM15885164
                        type: e-commerce
                        Amount: 1000
                        Transaction Date: '250612'
                        Transaction Time: '175324'
                        transactionStatus: approved
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 70
                        iva: 11.200000000000001
                        lklpayComission: 7.3509933774834435
                        fixedComission: 0
                        tefStatus: not-sent
                        depositStatus: pending
                        authorization: ''
                        commerceName: OPM
                      - _id: 684b6852931d5a948b01c183
                        ID Transaction: ECOM62191159
                        type: e-commerce
                        Amount: 1000
                        Transaction Date: '250612'
                        Transaction Time: '175250'
                        transactionStatus: approved
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 70
                        iva: 11.200000000000001
                        lklpayComission: 7.3509933774834435
                        fixedComission: 0
                        tefStatus: not-sent
                        depositStatus: pending
                        authorization: ''
                        commerceName: OPM
                      - _id: 684a06dd931d5a948b01c105
                        ID Transaction: ECOM75928436
                        type: e-commerce
                        Amount: 1000
                        Transaction Date: '250611'
                        Transaction Time: '164445'
                        transactionStatus: approved
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 70
                        iva: 11.200000000000001
                        lklpayComission: 7.3509933774834435
                        fixedComission: 0
                        tefStatus: not-sent
                        depositStatus: pending
                        authorization: ''
                        commerceName: OPM
                      - _id: 684a06c0931d5a948b01c0ff
                        ID Transaction: ECOM69940986
                        type: e-commerce
                        Amount: 1000
                        Transaction Date: '250611'
                        Transaction Time: '164416'
                        transactionStatus: approved
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 70
                        iva: 11.200000000000001
                        lklpayComission: 7.3509933774834435
                        fixedComission: 0
                        tefStatus: not-sent
                        depositStatus: pending
                        authorization: ''
                        commerceName: OPM
                      - _id: 684a0694931d5a948b01c0f9
                        ID Transaction: ECOM65277143
                        type: e-commerce
                        Amount: 0.01
                        Transaction Date: '250611'
                        Transaction Time: '164332'
                        transactionStatus: declined
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 0.0007000000000000001
                        iva: 0.00011200000000000001
                        lklpayComission: 7.350993377483459e-05
                        fixedComission: 0
                        tefStatus: n/a
                        depositStatus: n/a
                        authorization: ''
                        commerceName: OPM
                      - _id: 6849f8ff931d5a948b01c052
                        ID Transaction: ECOM69073510
                        type: e-commerce
                        Amount: 0.01
                        Transaction Date: '250611'
                        Transaction Time: '154535'
                        transactionStatus: declined
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 0.0007000000000000001
                        iva: 0.00011200000000000001
                        lklpayComission: 7.350993377483459e-05
                        fixedComission: 0
                        tefStatus: n/a
                        depositStatus: n/a
                        authorization: ''
                        commerceName: OPM
                      - _id: 6849f828931d5a948b01c004
                        ID Transaction: ECOM68850621
                        type: e-commerce
                        Amount: 0.01
                        Transaction Date: '250611'
                        Transaction Time: '154159'
                        transactionStatus: declined
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 0.0007000000000000001
                        iva: 0.00011200000000000001
                        lklpayComission: 7.350993377483459e-05
                        fixedComission: 0
                        tefStatus: n/a
                        depositStatus: n/a
                        authorization: ''
                        commerceName: OPM
                      - _id: 6849f7e4931d5a948b01bffb
                        ID Transaction: ECOM30460189
                        type: e-commerce
                        Amount: 0.01
                        Transaction Date: '250611'
                        Transaction Time: '154052'
                        transactionStatus: declined
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 0.0007000000000000001
                        iva: 0.00011200000000000001
                        lklpayComission: 7.350993377483459e-05
                        fixedComission: 0
                        tefStatus: n/a
                        depositStatus: n/a
                        authorization: ''
                        commerceName: OPM
                      - _id: 6849f7d2931d5a948b01bff5
                        ID Transaction: ECOM31916534
                        type: e-commerce
                        Amount: 0.01
                        Transaction Date: '250611'
                        Transaction Time: '154034'
                        transactionStatus: declined
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 0.0007000000000000001
                        iva: 0.00011200000000000001
                        lklpayComission: 7.350993377483459e-05
                        fixedComission: 0
                        tefStatus: n/a
                        depositStatus: n/a
                        authorization: ''
                        commerceName: OPM
                      - _id: 6849f573931d5a948b01bfc5
                        ID Transaction: ECOM55794423
                        type: e-commerce
                        Amount: 950
                        Transaction Date: '250611'
                        Transaction Time: '153027'
                        transactionStatus: approved
                        commerce: 667f41ae5bd41914e6ab1dba
                        comission: 66.5
                        iva: 10.64
                        lklpayComission: 6.983443708609272
                        fixedComission: 0
                        tefStatus: not-sent
                        depositStatus: pending
                        authorization: ''
                        commerceName: OPM
                      resume:
                        _id: null
                        Amount: 7750
                        Comission: 542.5
                        Deposit: 7120.7
                        Sold: 13
                        iva: 86.80000000000001
                        lklpayComission: 56.970198675496704
                        fixedComission: 0
                      total: 18
        '400':
          description: Petición incorrecta o token inválido.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      isOperational:
                        type: boolean
                        example: true
                      name:
                        type: string
                        example: Se requiere un token de acceso válido
                      statusCode:
                        type: integer
                        example: 400
                      code:
                        type: string
                        example: UNEXPECTED_ERROR
              example:
                error:
                  isOperational: true
                  name: Se requiere un token de acceso válido
                  statusCode: 400
                  code: UNEXPECTED_ERROR
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
              example:
                message: Internal Server Error
  /api/transaction/backoffice/getTransactionById/{id}:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Backoffice Service
      tags:
      - devices / transacciones / backoffice
      summary: Obtener transacción por ID (Backoffice)
      description: 'Obtiene el detalle de una transacción específica usando su ID.<br>
        **Requiere el header:** `Authorization: Bearer {token}`

        '
      operationId: getTransactionById
      security:
      - Authorization: []
      parameters:
      - name: id
        in: path
        required: true
        description: ID de la transacción a consultar.
        schema:
          type: string
      responses:
        '200':
          description: Transacción encontrada
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      _id:
                        type: string
                      POS:
                        type: string
                      SIC_Code:
                        type: string
                      ID_Afiliate:
                        type: string
                      ID_Terminal:
                        type: string
                      ID_Aggregator:
                        type: string
                      ID_Transaction:
                        type: string
                      Afiliate_Number:
                        type: string
                      type:
                        type: string
                      amount:
                        type: number
                      Card_Type:
                        type: string
                      Application_PAN:
                        type: string
                      Cardholder_Name:
                        type: string
                      MSI:
                        type: integer
                      PF:
                        type: integer
                      SKP:
                        type: integer
                      epn:
                        type: string
                      IFD_Serial_Number:
                        type: string
                      Transaction_Date:
                        type: string
                      Transaction_Time:
                        type: string
                      Points_BBVA:
                        type: string
                      status:
                        type: string
                      transactionStatus:
                        type: string
                      reference:
                        type: string
                      tlv:
                        type: string
                      commerce:
                        type: string
                      comission:
                        type: number
                      iva:
                        type: number
                      toDeposit:
                        type: number
                      deposited:
                        type: string
                      processorComission:
                        type: string
                      franchiseComission:
                        type: string
                      lklpayComission:
                        type: number
                      fixedComission:
                        type: number
                      processorFixedComission:
                        type: string
                      visaComission:
                        type: string
                      msiLklpayComission:
                        type: string
                      msiprocessorComission:
                        type: string
                      branchId:
                        type: string
                      tefStatus:
                        type: string
                      authorization:
                        type: string
                      depositStatus:
                        type: string
                      transaction:
                        type: string
                      latitude:
                        type: string
                      longitude:
                        type: string
                      tip:
                        type: number
                      bank:
                        type: string
                      bankProduct:
                        type: string
                      scheme:
                        type: string
                      processor:
                        type: string
                      tpvModel:
                        type: string
                      operationType:
                        type: string
                      readMode:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
                      active:
                        type: string
                      franchiseId:
                        type: string
                      advisorId:
                        type: string
                      ISO_CODE_DESCRIPTION:
                        type: string
                      ISO_CODE_RESPONSE:
                        type: string
                      originalRequest:
                        type: string
                      originalResponse:
                        type: string
                      processorId:
                        type: string
                      clientId:
                        type: string
                        nullable: true
                      Cardholder_Email:
                        type: string
                        nullable: true
                      Cardholder_Phone:
                        type: string
                        nullable: true
                      commerceInfo:
                        type: object
                      branchInfo:
                        type: object
              example:
                message: success
                response:
                  _id: 83fb7242-ba15-44a6-b62f-8d0bef53589d
                  POS: basium
                  SIC_Code: dignissimos
                  ID_Afiliate: AFF90759
                  ID_Terminal: TERM7338
                  ID_Aggregator: absens
                  ID_Transaction: caste
                  Afiliate_Number: repellat
                  type: et
                  amount: 10
                  Card_Type: infit
                  Application_PAN: 557907******2373
                  Cardholder_Name: Minnie Hammes
                  MSI: 490
                  PF: 923
                  SKP: 839
                  epn: ago
                  IFD_Serial_Number: decimus
                  Transaction_Date: '250604'
                  Transaction_Time: '075716'
                  Points_BBVA: '0'
                  status: PENDING
                  transactionStatus: approved
                  reference: dolor
                  tlv: bibo
                  commerce: 'coerceo                             '
                  comission: 3
                  iva: 2
                  toDeposit: 7
                  deposited: '7'
                  processorComission: '40.72'
                  franchiseComission: '75.71'
                  lklpayComission: 1
                  fixedComission: 0.5
                  processorFixedComission: '27.29'
                  visaComission: '16.36'
                  msiLklpayComission: '47.56'
                  msiprocessorComission: '94.43'
                  branchId: 'urbanus                             '
                  tefStatus: vitiosus
                  authorization: ''
                  depositStatus: adsuesco
                  transaction: 'dicta                               '
                  latitude: '34.49'
                  longitude: '6.42'
                  tip: 38.2
                  bank: id
                  bankProduct: caste
                  scheme: vos
                  processor: compono
                  tpvModel: agnosco
                  operationType: adduco
                  readMode: atavus
                  createdAt: '2025-05-22T06:53:55.876Z'
                  updatedAt: '2025-05-21T23:55:08.549Z'
                  active: '1'
                  franchiseId: 'tot                                 '
                  advisorId: 'tibi                                '
                  ISO_CODE_DESCRIPTION: conduco
                  ISO_CODE_RESPONSE: verbum
                  originalRequest: viscus
                  originalResponse: stultus
                  processorId: ultra
                  clientId: null
                  Cardholder_Email: null
                  Cardholder_Phone: null
                  commerceInfo: {}
                  branchInfo: {}
        '401':
          description: Token inválido o no autorizado
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 'JsonWebTokenError: invalid signature'
              example:
                error:
                  message: 'JsonWebTokenError: invalid signature'
        '404':
          description: Transacción no encontrada
          content:
            application/json:
              schema:
                type: object
                properties:
                  isOperational:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: Transacción no encontrada
                  statusCode:
                    type: integer
                    example: 404
                  code:
                    type: string
                    example: TRANSACTION_NOT_FOUND
              example:
                isOperational: true
                name: Transacción no encontrada
                statusCode: 404
                code: TRANSACTION_NOT_FOUND
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
                  code:
                    type: string
                    example: SERVER_ERROR
              example:
                message: Internal Server Error
                code: SERVER_ERROR
  /api/transaction/backoffice/transactionReport:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Reporte CSV de transacciones (Backoffice)
      description: 'Genera y descarga un reporte **CSV** de transacciones aprobadas
        filtrado por rango de fechas

        y, opcionalmente, por marca (brand) y comercio (commerce).

        Requiere token Backoffice (Bearer).

        El CSV se devuelve como **attachment** con `Content-Disposition` y `Content-Type:
        text/csv`.

        '
      operationId: getTransactionsReportBackoffice
      security:
      - BackofficeAuth: []
      parameters:
      - in: query
        name: startDate
        required: false
        description: 'Límite inferior inclusivo para `Transaction Date` (comparación
          string en DB).

          Si no se envía, se usa `"000000"` internamente.

          '
        schema:
          type: string
        example: '20250101'
      - in: query
        name: endDate
        required: false
        description: 'Límite superior inclusivo para `Transaction Date` (comparación
          string en DB).

          Si no se envía, se usa `"999999"` internamente.

          '
        schema:
          type: string
        example: '20250131'
      - in: query
        name: brand
        required: false
        description: Marca de tarjeta (se convierte internamente a una expresión regular
          con `getCardBrandRegex(brand)`).
        schema:
          type: string
        example: VISA
      - in: query
        name: commerce
        required: false
        description: ID de comercio a filtrar. Si no se envía, se usa un regex que
          coincide con cualquier valor.
        schema:
          type: string
        example: 64f9c1a4e5d4f5a8d929b4b2
      responses:
        '200':
          description: 'CSV generado correctamente. Ordenado por `Transaction Date`
            y `Transaction Time` ascendente.

            El archivo se devuelve como attachment.

            '
          headers:
            Content-Type:
              schema:
                type: string
              description: text/csv
            Content-Disposition:
              schema:
                type: string
              description: attachment; filename="report{startDate}-{endDate}_generatedAt{timestamp}.csv"
          content:
            text/csv:
              schema:
                type: string
                format: binary
              example: '"ID de Transaccion","Tipo","Monto","Comision","IVA","A depositar","Depositado","PAN
                de la Aplicacion","Tipo de Tarjeta","Estado","Fecha","Hora"

                "TRX-00012345","SALE","150.75","2.50","0.40","147.85","147.85","411111******1111","Crédito","Aprobada","2025-08-28","14:30:00"

                "TRX-00012346","SALE","220.00","3.00","0.48","216.52","216.52","411111******1111","Crédito","Aprobada","2025-08-28","15:05:10"

                '
        '400':
          description: 'Error en la petición o error capturado en el controller al
            generar el archivo.

            También se usa cuando falta el token en el middleware de Backoffice.

            '
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                missingToken:
                  summary: Falta token (middleware)
                  value:
                    error:
                      name: Se requiere un token de acceso válido
                      statusCode: 400
                generationError:
                  summary: Error al generar/enviar el CSV
                  value:
                    message: Ocurrió un error al generar el reporte
        '401':
          description: Token expirado u otro error de autenticación propagado por
            el middleware.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno no controlado.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              example:
                message: Internal Server Error
  /api/transaction/backoffice/transactionReport2:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Reporte CSV de transacciones (Backoffice) — versión 2
      description: 'Genera y descarga un reporte **CSV** de transacciones aprobadas
        filtrado por rango de fechas,

        marca (brand) y comercio (commerce). Incluye una fila de **totales** al final
        del archivo.

        No requiere autenticación Backoffice en este endpoint (según el router compartido).

        '
      operationId: getTransactionsReportBackoffice2
      parameters:
      - in: query
        name: startDate
        required: false
        description: 'Límite inferior inclusivo para `Transaction Date` (comparación
          string en DB).

          Si no se envía, se usa `"000000"` internamente.

          '
        schema:
          type: string
        example: '20250101'
      - in: query
        name: endDate
        required: false
        description: 'Límite superior inclusivo para `Transaction Date` (comparación
          string en DB).

          Si no se envía, se usa `"999999"` internamente.

          '
        schema:
          type: string
        example: '20250131'
      - in: query
        name: brand
        required: false
        description: Marca de tarjeta (se mapea a regex con `getCardBrandRegex(brand)`).
        schema:
          type: string
        example: VISA
      - in: query
        name: commerce
        required: false
        description: ID de comercio a filtrar. Si no se envía, se usa un regex que
          coincide con cualquier valor.
        schema:
          type: string
        example: 64f9c1a4e5d4f5a8d929b4b2
      responses:
        '200':
          description: 'CSV generado correctamente. Ordenado por `Transaction Date`
            y `Transaction Time` ascendente.

            El archivo se devuelve como attachment (`Content-Type: text/csv`).

            Al final incluye una sección de **Total** con sumatorias por columna.

            '
          headers:
            Content-Type:
              schema:
                type: string
              description: text/csv
            Content-Disposition:
              schema:
                type: string
              description: attachment; filename="report{startDate}-{endDate}_generatedAt{timestamp}.csv"
          content:
            text/csv:
              schema:
                type: string
                format: binary
              example: '"Monto","Comision","IVA","A depositar","Banco","Distro","Lklpay","Fijo","IvaBanco","IvaDistro","IvaLklpay","IvaFijo","Fecha","Hora","ID
                de Transaccion","Tipo","Tipo de Tarjeta","Comercio"

                150.75,2.50,0.40,147.85,0.80,0.50,0.90,0.30,0.13,0.08,0.14,0.05,2025-08-28,14:30:00,TRX-00012345,SALE,Crédito,"Comercio
                Ejemplo SA de CV"

                220.00,3.00,0.48,216.52,0.90,0.60,1.10,0.40,0.16,0.11,0.20,0.07,2025-08-28,15:05:10,TRX-00012346,SALE,Crédito,"Comercio
                Ejemplo SA de CV"


                Total

                Monto,Comision,IVA,A depositar,Banco,Distro,Lklpay,Fijo,IvaBanco,IvaDistro,IvaLklpay,IvaFijo

                370.75,5.50,0.88,364.37,1.70,1.10,2.00,0.70,0.29,0.19,0.34,0.12

                '
        '400':
          description: Error en la petición o al generar/enviar el CSV (el controller
            responde 400 en `catch`).
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                generationError:
                  summary: Error al generar/enviar el CSV
                  value:
                    message: Ocurrió un error al generar el reporte
  /api/transaction/backoffice/transactionReport3:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Descargar reporte Excel de transacciones (XLSX con totales por categoría)
      description: "Genera y descarga un reporte **Excel (.xlsx)** con el detalle\
        \ de transacciones filtradas por rango de fechas,\nmarca (brand) y comercio\
        \ (commerce). El archivo incluye:\n  - **Detalle por transacción** con campos\
        \ operativos (montos, comisiones, IVA, fechas, hora, IDs, tipo, tarjeta, estados).\n\
        \  - **Enriquecimiento** desde Profiles: nombre y **CLABE** de comercio y\
        \ franquicia.\n  - **Tres secciones de totales** al final:\n      1) **Total\
        \ aprobadas** (transactionStatus = APPROVED)\n      2) **Total canceladas\
        \ / declinadas** (transactionStatus ≠ APPROVED)\n      3) **Total aprobadas\
        \ TEF** (tefStatus = APPROVED)\n> Ordenado por `Transaction Date` y `Transaction\
        \ Time` ascendente. Usa `allowDiskUse: true`.\n"
      operationId: downloadTransactionsReportXlsxV3
      parameters:
      - in: query
        name: startDate
        required: false
        description: 'Límite inferior inclusivo para `Transaction Date` (comparación
          por string).

          Si no se envía, el servicio usa `"000000"`.

          '
        schema:
          type: string
        example: '250601'
      - in: query
        name: endDate
        required: false
        description: 'Límite superior inclusivo para `Transaction Date` (comparación
          por string).

          Si no se envía, el servicio usa `"999999"`.

          '
        schema:
          type: string
        example: '250630'
      - in: query
        name: brand
        required: false
        description: Marca de tarjeta; internamente se convierte a regex mediante
          `getCardBrandRegex(brand)`.
        schema:
          type: string
        example: VISA
      - in: query
        name: commerce
        required: false
        description: 'ID de comercio a filtrar. Solo se aplica si **commerce != ''all''**
          y **commerce != null**;

          de lo contrario se incluyen todos los comercios.

          '
        schema:
          type: string
        example: 667f41ae5bd41914e6ab1dba
      responses:
        '200':
          description: 'Excel generado correctamente. Se devuelve como **attachment**
            con

            `Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.

            El nombre del archivo sigue el patrón:

            `Reporte {startDate[-endDate]} Generado el {timestamp}.xlsx`.

            '
          headers:
            Content-Type:
              schema:
                type: string
              example: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
            Content-Disposition:
              schema:
                type: string
              example: attachment; filename="Reporte 250601-250630 Generado el 2025-06-01
                10-00.xlsx"
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
              examples:
                ejemplo:
                  summary: Archivo Excel de ejemplo
                  value: Archivo binario en formato .xlsx
        '400':
          description: Petición incorrecta o error al generar/enviar el archivo (capturado
            en el controller).
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                generationError:
                  summary: Error al generar el Excel
                  value:
                    message: Ocurrió un error al generar el reporte
  /api/transaction/backoffice/franchisesReport:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / backoffice
      summary: Reporte Excel de franquicias (resumen por distribuidor)
      description: "Genera y descarga un reporte **Excel (.xlsx)** con el resumen\
        \ por **franquicia** en el rango de fechas indicado.\nEl reporte incluye,\
        \ por distribuidor:\n  - Nombre de la franquicia (enriquecido desde Profiles)\n\
        \  - **Total Ventas**\n  - **Comisión Distribuidor**\n  - **Comercios** (conteo\
        \ de comercios con transacciones en el rango)\n\nFiltro interno:\n  - `Transaction\
        \ Date` entre `startDate` y `endDate`\n  - `transactionStatus = APPROVED`\n\
        \  - `tefStatus ∈ {APPROVED, WARNING}`\n  - `active = true`\n\nEl archivo\
        \ devuelve una hoja \"Report\" con encabezados estilizados y ajuste de ancho.\n"
      operationId: getFranchisesReportBackoffice
      parameters:
      - in: query
        name: startDate
        required: false
        description: Fecha de inicio (YYMMDD). Por defecto `"000000"`.
        schema:
          type: string
        example: '250601'
      - in: query
        name: endDate
        required: false
        description: Fecha de fin (YYMMDD). Por defecto `"999999"`.
        schema:
          type: string
        example: '250630'
      responses:
        '200':
          description: 'Excel generado correctamente. Se devuelve como **attachment**
            con

            `Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.

            Nombre sugerido: `Reporte de Distribuidores {startDate[-endDate]} Generado
            el {timestamp}.xlsx`.

            '
          headers:
            Content-Type:
              schema:
                type: string
              example: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
            Content-Disposition:
              schema:
                type: string
              example: attachment; filename="Reporte de Distribuidores 250601-250630
                Generado el 2025-06-30 12-00.xlsx"
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
              examples:
                ejemplo:
                  summary: Archivo Excel de ejemplo
                  value: Archivo binario en formato .xlsx
        '400':
          description: Error al generar o enviar el archivo (capturado en el controller).
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                generationError:
                  summary: Error de generación
                  value:
                    message: Ocurrió un error al generar el reporte
  /api/transaction/report/transactionsReport:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service
      tags:
      - devices / transacciones / report
      summary: Descargar reporte de transacciones (Excel)
      description: 'Genera y devuelve un archivo Excel con las transacciones dentro
        del rango de fechas indicado. Requiere token de backoffice.

        '
      operationId: getTransactionsReport
      security:
      - Authorization: []
      parameters:
      - name: startDate
        in: query
        description: Fecha/hora de inicio en formato AAMMDDhhmmss (YYMMDDHHMMSS).
        required: true
        schema:
          type: string
          pattern: ^\d{12}$
          example: '250731070000'
      - name: endDate
        in: query
        description: Fecha/hora de fin en formato AAMMDDhhmmss (YYMMDDHHMMSS).
        required: true
        schema:
          type: string
          pattern: ^\d{12}$
          example: '250801065959'
      responses:
        '200':
          description: Reporte generado correctamente (archivo Excel).
          headers:
            Content-Type:
              description: Tipo de archivo devuelto.
              schema:
                type: string
                example: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
            Content-Disposition:
              description: Sugerencia de nombre de archivo para descarga.
              schema:
                type: string
                example: attachment; filename="transactionsReport_2025-07-31_2025-08-01.xlsx"
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
        '400':
          description: Petición incorrecta o parámetros inválidos.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Validation failed
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        property:
                          type: string
                          example: startDate
                        constraints:
                          type: object
                          properties:
                            isNotEmpty:
                              type: string
                              example: startDate should not be empty
                            matches:
                              type: string
                              example: startDate must match YYMMDDHHMMSS format
              example:
                message: Validation failed
                errors:
                - property: startDate
                  constraints:
                    isNotEmpty: startDate should not be empty
                    matches: startDate must match YYMMDDHHMMSS format
                - property: endDate
                  constraints:
                    isNotEmpty: endDate should not be empty
                    matches: endDate must match YYMMDDHHMMSS format
        '500':
          description: Error interno del servidor (por ejemplo, token inválido o mal
            formado).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 'JsonWebTokenError: jwt malformed'
                required:
                - error
              example:
                error:
                  message: 'JsonWebTokenError: jwt malformed'
  /api/transaction/advisor/getTransactions:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / advisor
      summary: Listar transacciones del asesor (con resumen)
      description: 'Devuelve las transacciones asociadas al **asesor autenticado**
        en el rango de fechas indicado,

        con paginación y resumen agregado (monto total y conteo de ventas aprobadas).

        Requiere token de **Advisor** (Bearer).

        '
      operationId: getTransactionsAdvisor
      security:
      - AdvisorAuth: []
      parameters:
      - in: query
        name: startDate
        required: false
        description: Fecha de inicio (formato **YYMMDD**). Por defecto `"000000"`.
        schema:
          type: string
          pattern: ^\d{6}$
        example: '250601'
      - in: query
        name: endDate
        required: false
        description: Fecha de fin (formato **YYMMDD**). Por defecto `"999999"`.
        schema:
          type: string
          pattern: ^\d{6}$
        example: '250630'
      - in: query
        name: start
        required: false
        description: Índice inicial para paginación. Por defecto `0`.
        schema:
          type: integer
          minimum: 0
        example: 0
      - in: query
        name: end
        required: false
        description: Índice final (no inclusivo) para paginación. Si `0`, se usa límite
          10. Por defecto `10`.
        schema:
          type: integer
          minimum: 0
        example: 10
      - in: query
        name: commerce
        required: false
        description: ID de comercio para filtrar (opcional).
        schema:
          type: string
        example: 667f41ae5bd41914e6ab1dba
      - in: query
        name: serialNumber
        required: false
        description: Número de serie de la terminal (opcional). **Nota:** presente
          en el DTO; no se usa en el filtro actual del servicio.
        schema:
          type: string
        example: 0821407462
      responses:
        '200':
          description: Transacciones del asesor con resumen y total.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    properties:
                      transactions:
                        type: array
                        description: Registros paginados ordenados por fecha/hora
                          desc.
                        items:
                          type: object
                          properties:
                            Amount:
                              type: number
                              example: 1000
                            Transaction Date:
                              type: string
                              example: '250612'
                            Transaction Time:
                              type: string
                              example: '175324'
                            transactionStatus:
                              type: string
                              example: approved
                            authorization:
                              type: string
                              nullable: true
                              example: A12345
                            commerce:
                              type: string
                              example: 667f41ae5bd41914e6ab1dba
                            ID Transaction:
                              type: string
                              example: ECOM15885164
                      resume:
                        type: object
                        description: Resumen de aprobadas (sumatoria calculada en
                          agregación).
                        properties:
                          Amount:
                            type: number
                            example: 1500
                          Sold:
                            type: integer
                            example: 2
                      total:
                        type: integer
                        description: Total de registros que cumplen el filtro (sin
                          paginar).
                        example: 23
              examples:
                ejemplo:
                  summary: Respuesta con paginación y resumen
                  value:
                    message: success
                    response:
                      transactions:
                      - Amount: 1000
                        Transaction Date: '250612'
                        Transaction Time: '175324'
                        transactionStatus: approved
                        authorization: A12345
                        commerce: 667f41ae5bd41914e6ab1dba
                        ID Transaction: ECOM15885164
                      - Amount: 500
                        Transaction Date: '250612'
                        Transaction Time: '114500'
                        transactionStatus: approved
                        authorization: A12346
                        commerce: 667f41ae5bd41914e6ab1dba
                        ID Transaction: ECOM62191159
                      resume:
                        Amount: 1500
                        Sold: 2
                      total: 23
        '400':
          description: Token faltante / inválido o validación de parámetros (DTO).
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                missingToken:
                  summary: Falta token (middleware)
                  value:
                    error:
                      name: Se requiere un token de acceso válido
                      statusCode: 400
                validationError:
                  summary: startDate/endDate con formato inválido (YYMMDD)
                  value:
                    error:
                      message: startDate must be YYMMDD format
        '401':
          description: Token expirado u otro error de autenticación propagado por
            el middleware.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno no controlado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/advisor/getTransactionById/{id}:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / advisor
      summary: Obtener transacción por ID (asesor)
      description: 'Devuelve el detalle de una transacción perteneciente al **asesor
        autenticado**.

        Si no existe o no pertenece al asesor, responde **404**.

        Requiere token de **Advisor** (Bearer).

        '
      operationId: getTransactionByIdAdvisor
      security:
      - AdvisorAuth: []
      parameters:
      - in: path
        name: id
        required: true
        description: Identificador único de la transacción (`_id` en base de datos).
        schema:
          type: string
        example: 684b6874931d5a948b01c189
      responses:
        '200':
          description: Transacción encontrada para el asesor autenticado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: success
                  response:
                    type: object
                    additionalProperties: true
                    properties:
                      _id:
                        type: string
                        example: 684b6874931d5a948b01c189
                      ID Transaction:
                        type: string
                        example: ECOM15885164
                      Amount:
                        type: number
                        example: 1000
                      Transaction Date:
                        type: string
                        example: '250612'
                      Transaction Time:
                        type: string
                        example: '175324'
                      transactionStatus:
                        type: string
                        example: approved
                      type:
                        type: string
                        example: e-commerce
                      commerce:
                        type: string
                        example: 667f41ae5bd41914e6ab1dba
                      franchiseId:
                        type: string
                        example: 66a0123e5bd41914e6ab1aaa
                      branchId:
                        type: string
                        nullable: true
                        example: 66a0123e5bd41914e6ab1bbb
                      commerceName:
                        type: string
                        example: Comercio Ejemplo SA de CV
                      franchiseName:
                        type: string
                        example: Distribuidor Norte
                      branchName:
                        type: string
                        nullable: true
                        example: Sucursal Centro
                      commerceInfo:
                        type: object
                        properties:
                          commerceName:
                            type: string
                            example: Comercio Ejemplo SA de CV
                          commerceInternalId:
                            type: string
                            example: C-000123
                          commerceResponsible:
                            type: string
                            example: Ana Gómez
              examples:
                ejemplo:
                  summary: Respuesta exitosa con campos enriquecidos
                  value:
                    message: success
                    response:
                      _id: 684b6874931d5a948b01c189
                      ID Transaction: ECOM15885164
                      Amount: 1000
                      Transaction Date: '250612'
                      Transaction Time: '175324'
                      transactionStatus: approved
                      type: e-commerce
                      commerce: 667f41ae5bd41914e6ab1dba
                      franchiseId: 66a0123e5bd41914e6ab1aaa
                      branchId: 66a0123e5bd41914e6ab1bbb
                      commerceName: Comercio Ejemplo SA de CV
                      franchiseName: Distribuidor Norte
                      branchName: Sucursal Centro
                      commerceInfo:
                        commerceName: Comercio Ejemplo SA de CV
                        commerceInternalId: C-000123
                        commerceResponsible: Ana Gómez
        '400':
          description: Token faltante/ inválido (middleware) u otro error de validación.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                missingToken:
                  summary: Falta token
                  value:
                    error:
                      name: Se requiere un token de acceso válido
                      statusCode: 400
        '401':
          description: Token expirado u otro error de autenticación propagado por
            el middleware.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '404':
          description: No se encontró la transacción para el asesor autenticado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: No se encontró la transacción
                      statusCode:
                        type: integer
                        example: 404
        '500':
          description: Error interno no controlado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
  /api/transaction/advisor/transactionReport:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / advisor
      summary: Descargar reporte Excel de transacciones del asesor
      description: 'Genera y descarga un reporte **Excel (.xlsx)** con las transacciones
        del **asesor autenticado**,

        filtradas por rango de fechas (`startDate`–`endDate`) y, opcionalmente, por
        `commerce`.

        Requiere token de **Advisor** (Bearer).


        Notas:

        - `startDate` y `endDate` deben usar formato **YYMMDD** (validados por `GetTxReportDto`).

        - El parámetro `serialNumber` existe en el DTO pero **no se usa actualmente**
        en el filtro del servicio.

        '
      operationId: getTransactionsReportAdvisor
      security:
      - AdvisorAuth: []
      parameters:
      - in: query
        name: startDate
        required: true
        description: Fecha de inicio en formato YYMMDD.
        schema:
          type: string
          pattern: ^\d{6}$
        example: '250601'
      - in: query
        name: endDate
        required: true
        description: Fecha de fin en formato YYMMDD.
        schema:
          type: string
          pattern: ^\d{6}$
        example: '250630'
      - in: query
        name: commerce
        required: false
        description: ID de comercio a filtrar. Si no se envía, se incluyen todos los
          comercios del asesor.
        schema:
          type: string
        example: 667f41ae5bd41914e6ab1dba
      - in: query
        name: serialNumber
        required: false
        description: Número de serie de la terminal. Presente en el DTO; actualmente
          no se usa en el filtro del servicio.
        schema:
          type: string
        example: 0821407462
      responses:
        '200':
          description: 'Excel generado correctamente. Se devuelve como **attachment**
            con

            `Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.

            Nombre de archivo: `Reporte {startDate[-endDate]} Generado el {timestamp}.xlsx`.

            '
          headers:
            Content-Type:
              schema:
                type: string
              example: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
            Content-Disposition:
              schema:
                type: string
              example: attachment; filename="Reporte 250601-250630 Generado el 2025-06-30
                12-00.xlsx"
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
              examples:
                ejemplo:
                  summary: Archivo Excel de ejemplo
                  value: Archivo binario en formato .xlsx
        '400':
          description: Error de validación (DTO) o fallo al generar/enviar el archivo.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              examples:
                validationError:
                  summary: startDate/endDate con formato inválido
                  value:
                    error:
                      message: startDate must be YYMMDD format
                generationError:
                  summary: Error de generación
                  value:
                    message: Ocurrió un error al generar el reporte
        '401':
          description: Token expirado u otro error de autenticación (middleware).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
  /api/transaction/advisor/voucher/{id}:
    get:
      servers:
      - url: https://dev-api-baz.viergegroup.com/d4c625d83e5ev/
        description: Devices Service (dev)
      tags:
      - devices / transacciones / advisor
      summary: Descargar voucher PDF de una transacción (asesor)
      description: 'Descarga el **voucher en PDF** de la transacción indicada por
        su `_id`.

        Requiere token de **Advisor** (Bearer).


        Además, el sistema registra la descarga creando un documento en `VoucherDownloadModel`

        con: `userId`, `userName`, `userEmail`, `downloadTime`, `voucherNumber` (desde
        `query.id`) y `origin` (desde `query.origin`).

        '
      operationId: downloadAdvisorTransactionVoucherPdf
      security:
      - AdvisorAuth: []
      parameters:
      - in: path
        name: id
        required: true
        description: Identificador único de la transacción (`_id` en base de datos).
        schema:
          type: string
        example: 684b6874931d5a948b01c189
      - in: query
        name: id
        required: false
        description: 'Número de voucher que se registra en la bitácora de descargas
          (`voucherNumber`).

          **Nota:** no afecta el archivo generado; se usa solo para logging.

          '
        schema:
          type: string
        example: ECOM15885164
      - in: query
        name: origin
        required: false
        description: Origen de la descarga que se registra en la bitácora (por ejemplo,
          `dashboard`, `mobile`).
        schema:
          type: string
        example: dashboard
      responses:
        '200':
          description: Voucher generado correctamente. Se devuelve como **attachment**
            PDF.
          headers:
            Content-Type:
              schema:
                type: string
              example: application/pdf
            Content-Disposition:
              schema:
                type: string
              example: attachment; filename="684b6874931d5a948b01c189.pdf"
          content:
            application/pdf:
              schema:
                type: string
                format: binary
              examples:
                ejemplo:
                  summary: Archivo PDF de ejemplo
                  value: Archivo binario en formato .pdf
        '400':
          description: Error funcional (transacción o comercio no encontrados) u otros
            errores controlados.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    additionalProperties: true
              examples:
                txNotFound:
                  summary: Transacción no encontrada
                  value:
                    error:
                      name: No se encontró la transacción
                      statusCode: 400
                commerceNotFound:
                  summary: Comercio no encontrado
                  value:
                    error:
                      name: No se encontró el comercio
                      statusCode: 400
        '401':
          description: Token inválido/expirado (middleware de Advisor).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      name:
                        type: string
                        example: TokenExpiredError
                      message:
                        type: string
                        example: jwt expired
                      code:
                        type: string
                        example: ACCESS_TOKEN_EXPIRED
              example:
                error:
                  name: TokenExpiredError
                  message: jwt expired
                  code: ACCESS_TOKEN_EXPIRED
        '500':
          description: Error interno no controlado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Internal Server Error
components:
  securitySchemes:
    Authorization:
      type: apiKey
      in: header
      name: Authorization
      description: 'API key, Usualmente en el formato "Bearer {token}".

        '
    CommerceAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'Token JWT de comercio (Authorization: Bearer <token>)'
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'HTTP Bearer (JWT). Usar: Authorization: Bearer <token>'
    BackofficeAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'Token JWT de backoffice (Authorization: Bearer <token>)'
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API Key para endpoints ISO eGlobal (header X-API-Key).
    AdvisorAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Cliente:
      type: object
      properties:
        id:
          type: string
        id_externo:
          type: string
        nombre:
          type: string
        apellido_paterno:
          type: string
        apellido_materno:
          type: string
        sexo:
          type: string
        email:
          type: string
        telefono:
          $ref: '#/components/schemas/Telefono'
        nacimiento:
          type: string
          format: date-time
        direccion:
          $ref: '#/components/schemas/Direccion'
        creacion_externa:
          type: string
          format: date-time
        device_fingerprint:
          type: string
    ClienteRequest:
      type: object
      required:
      - id_externo
      - nombre
      - apellido_paterno
      - apellido_materno
      - sexo
      - email
      - telefono
      - nacimiento
      - direccion
      properties:
        id_externo:
          type: string
          example: '12345'
        nombre:
          type: string
          example: Jose
        apellido_paterno:
          type: string
          example: Pérez
        apellido_materno:
          type: string
          example: García
        sexo:
          type: string
          example: masculino
        email:
          type: string
          example: juan.perez@example.com
        telefono:
          $ref: '#/components/schemas/Telefono'
        nacimiento:
          type: string
          format: date-time
          example: '1990-05-20T00:00:00.000Z'
        direccion:
          $ref: '#/components/schemas/Direccion'
        creacion_externa:
          type: string
          format: date-time
          example: '2023-10-01T10:30:00.000Z'
        device_fingerprint:
          type: string
          example: abc123xyz789fingerprint
    ClientesListResponse:
      type: object
      properties:
        count:
          type: integer
          example: 5
        pagination:
          type: object
          properties:
            page:
              type: integer
              example: 1
            perPage:
              type: integer
              example: 10
            totalPages:
              type: integer
              example: 1
        externalClient:
          type: array
          items:
            $ref: '#/components/schemas/Cliente'
    ClienteResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        http_code:
          type: integer
          example: 200
        datetime:
          type: string
          format: date-time
          example: '2025-07-15T18:14:12.381Z'
        timestamp:
          type: integer
          example: 1752603252381
        data:
          type: object
          properties:
            cliente:
              $ref: '#/components/schemas/Cliente'
    ClienteEliminadoResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        http_code:
          type: integer
          example: 200
        datetime:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
        timestamp:
          type: integer
          example: 0
        data:
          type: object
          properties:
            cliente:
              type: object
              properties:
                id:
                  type: string
                  example: 497f6eca-6276-4993-bfeb-53cbbbba6f08
                eliminacion:
                  type: string
                  format: date-time
                  example: '2019-08-24T14:15:22Z'
    ClienteCardsResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        http_code:
          type: integer
          example: 200
        datetime:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
        timestamp:
          type: integer
          example: 0
        data:
          type: object
          properties:
            tarjetas:
              type: object
              properties:
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/Card'
                desde:
                  type: integer
                  example: 0
                hasta:
                  type: integer
                  example: 0
                registros_por_pagina:
                  type: integer
                  example: 10
                pagina_actual:
                  type: integer
                  example: 1
                ultima_pagina:
                  type: integer
                  example: 1
                total_pagina:
                  type: integer
                  example: 0
                total:
                  type: integer
                  example: 0
    Card:
      type: object
      properties:
        id:
          type: string
          example: bbe194d8-3865-4fa2-baa1-4a9415a836dc
        token:
          type: string
          example: string
        pan:
          type: string
          example: 411111******1111
        terminacion:
          type: integer
          example: 0
        nombre:
          type: string
          example: string
        expiracion_mes:
          type: integer
          example: 1
        expiracion_anio:
          type: integer
          example: 0
        direccion:
          $ref: '#/components/schemas/DireccionCard'
        iin:
          type: integer
          example: 0
        marca:
          type: string
          example: visa
        cliente_id:
          type: string
          example: string
        default:
          type: boolean
          example: true
        cargo_unico:
          type: boolean
          example: true
        creacion:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
        actualizacion:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
    CardRequest:
      type: object
      required:
      - nombre
      - pan
      - cvv2
      - expiracion_mes
      - expiracion_anio
      - direccion
      - cliente_id
      - default
      - cargo_unico
      properties:
        nombre:
          type: string
          example: Juan Pérez
        pan:
          type: string
          example: '5267774322222222'
        cvv2:
          type: string
          example: '123'
        expiracion_mes:
          type: integer
          example: 1
        expiracion_anio:
          type: integer
          example: 2029
        direccion:
          $ref: '#/components/schemas/Direccion'
        cliente_id:
          type: string
          example: 3fb1a8ec-08e5-4c09-b3c5-654cfef22941
        default:
          type: boolean
          example: true
        cargo_unico:
          type: boolean
          example: true
    CardResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        http_code:
          type: integer
          example: 201
        datetime:
          type: string
          format: date-time
          example: '2025-07-15T18:14:12.381Z'
        timestamp:
          type: integer
          example: 1752603252381
        data:
          type: object
          properties:
            card:
              $ref: '#/components/schemas/Card'
    CardEliminadaResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        http_code:
          type: integer
          example: 200
        datetime:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
        timestamp:
          type: integer
          example: 0
        data:
          type: object
          properties:
            card:
              type: object
              properties:
                id:
                  type: string
                  example: bbe194d8-3865-4fa2-baa1-4a9415a836dc
                eliminacion:
                  type: string
                  format: date-time
                  example: '2019-08-24T14:15:22Z'
    Direccion:
      type: object
      properties:
        linea1:
          type: string
          example: Av. Reforma 123
        linea2:
          type: string
          example: Piso 2
        linea3:
          type: string
          example: Oficina 5B
        cp:
          type: string
          example: '06000'
        telefono:
          $ref: '#/components/schemas/Telefono'
        municipio:
          type: string
          example: Cuauhtémoc
        ciudad:
          type: string
          example: Ciudad de México
        estado:
          type: string
          example: CDMX
        pais:
          type: string
          example: México
        referencia_1:
          type: string
          example: Frente al museo
        referencia_2:
          type: string
          example: Cerca de la estación Hidalgo
        longitud:
          type: number
          format: float
          example: -99.1332015991211
        latitud:
          type: number
          format: float
          example: 19.432600021362305
    DireccionCard:
      type: object
      properties:
        creacion:
          type: string
          format: date-time
          example: '2019-08-24T14:15:22Z'
        linea1:
          type: string
          example: string
        linea2:
          type: string
          example: string
        linea3:
          type: string
          example: string
        cp:
          type: string
          example: string
        telefono:
          $ref: '#/components/schemas/Telefono'
        municipio:
          type: string
          example: string
        ciudad:
          type: string
          example: string
        estado:
          type: string
          example: str
        pais:
          type: string
          example: str
        referencia_1:
          type: string
          example: string
        referencia_2:
          type: string
          example: string
        longitud:
          type: number
          example: -90
        latitud:
          type: number
          example: -90
    Telefono:
      type: object
      properties:
        tipo:
          type: string
          example: movil
        codigo_pais:
          type: string
          example: '+52'
        codigo_area:
          type: string
          example: '55'
        prefijo:
          type: string
          example: '123'
        numero:
          type: string
          example: '4567890'
        extension:
          type: integer
          example: 101
    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        http_code:
          type: integer
          example: 400
        datetime:
          type: string
          format: date-time
          example: '2025-07-15T18:14:12.381Z'
        timestamp:
          type: integer
          example: 1752603252381
        message:
          type: string
          example: Parámetros inválidos o faltantes
        details:
          type: array
          items:
            type: string
          example:
          - El campo 'email' es obligatorio.
